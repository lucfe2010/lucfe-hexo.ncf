<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>python web scraping - Lucfe Knowledge Documentation</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Lucfe Knowledge Documentation"><meta name="msapplication-TileImage" content="/assets/images/favicon_l.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lucfe Knowledge Documentation"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="httpuri url URL stands for Uniform Resource Locator. A URL is nothing more than the address of a given unique resource on the Web. In theory, each valid URL points to a unique resource.    http https"><meta property="og:type" content="blog"><meta property="og:title" content="python web scraping"><meta property="og:url" content="https://ncf2010.us.kg/0004%20Formal%20science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF%20Computer%20science/Software%20notations%C2%A0and%C2%A0tools/python/python_web_scraping/"><meta property="og:site_name" content="Lucfe Knowledge Documentation"><meta property="og:description" content="httpuri url URL stands for Uniform Resource Locator. A URL is nothing more than the address of a given unique resource on the Web. In theory, each valid URL points to a unique resource.    http https"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/python_3_web_scraping_cuiqincai/image.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/python_3_web_scraping_cuiqincai/image-1.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/xiaoyuan_python/image.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-1.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-2.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-4.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-6.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-3.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/it_sisu_web_scraping/image.png"><meta property="og:image" content="https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-5.png"><meta property="article:published_time" content="2024-02-26T07:20:18.425Z"><meta property="article:modified_time" content="2024-03-03T08:43:41.989Z"><meta property="article:author" content="lucfe"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://ncf2010.us.kg/assets/images/python_3_web_scraping_cuiqincai/image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ncf2010.us.kg/0004%20Formal%20science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF%20Computer%20science/Software%20notations%C2%A0and%C2%A0tools/python/python_web_scraping/"},"headline":"python web scraping","image":["https://ncf2010.us.kg/assets/images/python_3_web_scraping_cuiqincai/image.png","https://ncf2010.us.kg/assets/images/python_3_web_scraping_cuiqincai/image-1.png","https://ncf2010.us.kg/assets/images/xiaoyuan_python/image.png","https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-1.png","https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-2.png","https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-4.png","https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-6.png","https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-3.png","https://ncf2010.us.kg/assets/images/it_sisu_web_scraping/image.png","https://ncf2010.us.kg/assets/images/xiaoyuan_python/image-5.png"],"datePublished":"2024-02-26T07:20:18.425Z","dateModified":"2024-03-03T08:43:41.989Z","author":{"@type":"Person","name":"lucfe"},"publisher":{"@type":"Organization","name":"Lucfe Knowledge Documentation","logo":{"@type":"ImageObject","url":{"text":"Lucfe Knowledges"}}},"description":"httpuri url URL stands for Uniform Resource Locator. A URL is nothing more than the address of a given unique resource on the Web. In theory, each valid URL points to a unique resource.    http https"}</script><link rel="canonical" href="https://ncf2010.us.kg/0004%20Formal%20science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF%20Computer%20science/Software%20notations%C2%A0and%C2%A0tools/python/python_web_scraping/"><link rel="alternate" href="https://ncf2010.us.kg/atom.xml" title="Lucfe Knowledge Documentation" type="application/atom+xml"><link rel="icon" href="/assets/images/favicon_l.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Lucfe Knowledges</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-02-26T07:20:18.425Z" title="2024/2/26 15:20:18">2024-02-26</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-03-03T08:43:41.989Z" title="2024/3/3 16:43:41">2024-03-03</time></span><span class="level-item">an hour read (About 11309 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">python web scraping</h1><div class="content"><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>uri url</p>
<p>URL stands for Uniform Resource Locator. A URL is nothing more than the address of a given unique resource on the Web. In theory, each valid URL points to a unique resource. </p>
<p><img src="/assets/images/python_3_web_scraping_cuiqincai/image.png" alt="Alt text"></p>
<hr>
<p>http https</p>
<p>tls&#x2F;ssl</p>
<p>Transport Layer Security (TLS) is a cryptographic protocol designed to provide communications security over a computer network. The protocol is widely used in applications such as email, instant messaging, and voice over IP, but its use in securing HTTPS remains the most publicly visible.</p>
<p>TLS builds on the now-deprecated SSL (Secure Sockets Layer) specifications (1994, 1995, 1996)</p>
<hr>
<p>chrome developer tool<br>network</p>
<p>Status. The HTTP response code.</p>
<p>Type. The resource type.</p>
<p>Initiator. What caused a resource to be requested. Clicking a link in the Initiator column takes you to the source code that caused the request.</p>
<p>Time. How long the request took.</p>
<p>Waterfall. A graphical representation of the different stages of the request. Hover over a Waterfall to see a breakdown.</p>
<hr>
<p>detail</p>
<p>The Headers tab is shown. Use this tab to inspect HTTP headers.</p>
<p>the Preview tab. A basic rendering of the HTML is shown.</p>
<p>the Response tab. The HTML source code is shown.</p>
<p>the Timing tab. A breakdown of the network activity for this resource is shown.</p>
<hr>
<p>http request</p>
<p>header<br>content-type: internet media type MIME<br>HTML –&gt; text&#x2F;html<br>GIF –&gt; image&#x2F;gif<br>JSON –&gt; application&#x2F;json<br>xml –&gt; text&#x2F;xml<br>form file –&gt; multipart&#x2F;form-data<br>form data –&gt; application&#x2F;x-www-form-urlencoded</p>
<hr>
<p>http response</p>
<p>Information responses<br>100 Continue<br>This interim response indicates that the client should continue the request or ignore the response if the request is already finished.</p>
<p>101 Switching Protocols<br>This code is sent in response to an Upgrade request header from the client and indicates the protocol the server is switching to.</p>
<p>102 Processing (WebDAV)<br>This code indicates that the server has received and is processing the request, but no response is available yet.</p>
<p>103 Early Hints<br>This status code is primarily intended to be used with the Link header, letting the user agent start preloading resources while the server prepares a response or preconnect to an origin from which the page will need resources.</p>
<p>Successful responses<br>200 OK<br>The request succeeded. The result meaning of “success” depends on the HTTP method:</p>
<p>GET: The resource has been fetched and transmitted in the message body.<br>HEAD: The representation headers are included in the response without any message body.<br>PUT or POST: The resource describing the result of the action is transmitted in the message body.<br>TRACE: The message body contains the request message as received by the server.<br>201 Created<br>The request succeeded, and a new resource was created as a result. This is typically the response sent after POST requests, or some PUT requests.</p>
<p>202 Accepted<br>The request has been received but not yet acted upon. It is noncommittal, since there is no way in HTTP to later send an asynchronous response indicating the outcome of the request. It is intended for cases where another process or server handles the request, or for batch processing.</p>
<p>203 Non-Authoritative Information<br>This response code means the returned metadata is not exactly the same as is available from the origin server, but is collected from a local or a third-party copy. This is mostly used for mirrors or backups of another resource. Except for that specific case, the 200 OK response is preferred to this status.</p>
<p>204 No Content<br>There is no content to send for this request, but the headers may be useful. The user agent may update its cached headers for this resource with the new ones.</p>
<p>205 Reset Content<br>Tells the user agent to reset the document which sent this request.</p>
<p>206 Partial Content<br>This response code is used when the Range header is sent from the client to request only part of a resource.</p>
<p>207 Multi-Status (WebDAV)<br>Conveys information about multiple resources, for situations where multiple status codes might be appropriate.</p>
<p>208 Already Reported (WebDAV)<br>Used inside a <a href="dav:propstat">dav:propstat</a> response element to avoid repeatedly enumerating the internal members of multiple bindings to the same collection.</p>
<p>226 IM Used (HTTP Delta encoding)<br>The server has fulfilled a GET request for the resource, and the response is a representation of the result of one or more instance-manipulations applied to the current instance.</p>
<p>Redirection messages<br>300 Multiple Choices<br>The request has more than one possible response. The user agent or user should choose one of them. (There is no standardized way of choosing one of the responses, but HTML links to the possibilities are recommended so the user can pick.)</p>
<p>301 Moved Permanently<br>The URL of the requested resource has been changed permanently. The new URL is given in the response.</p>
<p>302 Found<br>This response code means that the URI of requested resource has been changed temporarily. Further changes in the URI might be made in the future. Therefore, this same URI should be used by the client in future requests.</p>
<p>303 See Other<br>The server sent this response to direct the client to get the requested resource at another URI with a GET request.</p>
<p>304 Not Modified<br>This is used for caching purposes. It tells the client that the response has not been modified, so the client can continue to use the same cached version of the response.</p>
<p>305 Use Proxy Deprecated<br>Defined in a previous version of the HTTP specification to indicate that a requested response must be accessed by a proxy. It has been deprecated due to security concerns regarding in-band configuration of a proxy.</p>
<p>306 unused<br>This response code is no longer used; it is just reserved. It was used in a previous version of the HTTP&#x2F;1.1 specification.</p>
<p>307 Temporary Redirect<br>The server sends this response to direct the client to get the requested resource at another URI with the same method that was used in the prior request. This has the same semantics as the 302 Found HTTP response code, with the exception that the user agent must not change the HTTP method used: if a POST was used in the first request, a POST must be used in the second request.</p>
<p>308 Permanent Redirect<br>This means that the resource is now permanently located at another URI, specified by the Location: HTTP Response header. This has the same semantics as the 301 Moved Permanently HTTP response code, with the exception that the user agent must not change the HTTP method used: if a POST was used in the first request, a POST must be used in the second request.</p>
<p>Client error responses<br>400 Bad Request<br>The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid request message framing, or deceptive request routing).</p>
<p>401 Unauthorized<br>Although the HTTP standard specifies “unauthorized”, semantically this response means “unauthenticated”. That is, the client must authenticate itself to get the requested response.</p>
<p>402 Payment Required Experimental<br>This response code is reserved for future use. The initial aim for creating this code was using it for digital payment systems, however this status code is used very rarely and no standard convention exists.</p>
<p>403 Forbidden<br>The client does not have access rights to the content; that is, it is unauthorized, so the server is refusing to give the requested resource. Unlike 401 Unauthorized, the client’s identity is known to the server.</p>
<p>404 Not Found<br>The server cannot find the requested resource. In the browser, this means the URL is not recognized. In an API, this can also mean that the endpoint is valid but the resource itself does not exist. Servers may also send this response instead of 403 Forbidden to hide the existence of a resource from an unauthorized client. This response code is probably the most well known due to its frequent occurrence on the web.</p>
<p>405 Method Not Allowed<br>The request method is known by the server but is not supported by the target resource. For example, an API may not allow calling DELETE to remove a resource.</p>
<p>406 Not Acceptable<br>This response is sent when the web server, after performing server-driven content negotiation, doesn’t find any content that conforms to the criteria given by the user agent.</p>
<p>407 Proxy Authentication Required<br>This is similar to 401 Unauthorized but authentication is needed to be done by a proxy.</p>
<p>408 Request Timeout<br>This response is sent on an idle connection by some servers, even without any previous request by the client. It means that the server would like to shut down this unused connection. This response is used much more since some browsers, like Chrome, Firefox 27+, or IE9, use HTTP pre-connection mechanisms to speed up surfing. Also note that some servers merely shut down the connection without sending this message.</p>
<p>409 Conflict<br>This response is sent when a request conflicts with the current state of the server.</p>
<p>410 Gone<br>This response is sent when the requested content has been permanently deleted from server, with no forwarding address. Clients are expected to remove their caches and links to the resource. The HTTP specification intends this status code to be used for “limited-time, promotional services”. APIs should not feel compelled to indicate resources that have been deleted with this status code.</p>
<p>411 Length Required<br>Server rejected the request because the Content-Length header field is not defined and the server requires it.</p>
<p>412 Precondition Failed<br>The client has indicated preconditions in its headers which the server does not meet.</p>
<p>413 Payload Too Large<br>Request entity is larger than limits defined by server. The server might close the connection or return an Retry-After header field.</p>
<p>414 URI Too Long<br>The URI requested by the client is longer than the server is willing to interpret.</p>
<p>415 Unsupported Media Type<br>The media format of the requested data is not supported by the server, so the server is rejecting the request.</p>
<p>416 Range Not Satisfiable<br>The range specified by the Range header field in the request cannot be fulfilled. It’s possible that the range is outside the size of the target URI’s data.</p>
<p>417 Expectation Failed<br>This response code means the expectation indicated by the Expect request header field cannot be met by the server.</p>
<p>418 I’m a teapot<br>The server refuses the attempt to brew coffee with a teapot.</p>
<p>421 Misdirected Request<br>The request was directed at a server that is not able to produce a response. This can be sent by a server that is not configured to produce responses for the combination of scheme and authority that are included in the request URI.</p>
<p>422 Unprocessable Content (WebDAV)<br>The request was well-formed but was unable to be followed due to semantic errors.</p>
<p>423 Locked (WebDAV)<br>The resource that is being accessed is locked.</p>
<p>424 Failed Dependency (WebDAV)<br>The request failed due to failure of a previous request.</p>
<p>425 Too Early Experimental<br>Indicates that the server is unwilling to risk processing a request that might be replayed.</p>
<p>426 Upgrade Required<br>The server refuses to perform the request using the current protocol but might be willing to do so after the client upgrades to a different protocol. The server sends an Upgrade header in a 426 response to indicate the required protocol(s).</p>
<p>428 Precondition Required<br>The origin server requires the request to be conditional. This response is intended to prevent the ‘lost update’ problem, where a client GETs a resource’s state, modifies it and PUTs it back to the server, when meanwhile a third party has modified the state on the server, leading to a conflict.</p>
<p>429 Too Many Requests<br>The user has sent too many requests in a given amount of time (“rate limiting”).</p>
<p>431 Request Header Fields Too Large<br>The server is unwilling to process the request because its header fields are too large. The request may be resubmitted after reducing the size of the request header fields.</p>
<p>451 Unavailable For Legal Reasons<br>The user agent requested a resource that cannot legally be provided, such as a web page censored by a government.</p>
<p>Server error responses<br>500 Internal Server Error<br>The server has encountered a situation it does not know how to handle.</p>
<p>501 Not Implemented<br>The request method is not supported by the server and cannot be handled. The only methods that servers are required to support (and therefore that must not return this code) are GET and HEAD.</p>
<p>502 Bad Gateway<br>This error response means that the server, while working as a gateway to get a response needed to handle the request, got an invalid response.</p>
<p>503 Service Unavailable<br>The server is not ready to handle the request. Common causes are a server that is down for maintenance or that is overloaded. Note that together with this response, a user-friendly page explaining the problem should be sent. This response should be used for temporary conditions and the Retry-After HTTP header should, if possible, contain the estimated time before the recovery of the service. The webmaster must also take care about the caching-related headers that are sent along with this response, as these temporary condition responses should usually not be cached.</p>
<p>504 Gateway Timeout<br>This error response is given when the server is acting as a gateway and cannot get a response in time.</p>
<p>505 HTTP Version Not Supported<br>The HTTP version used in the request is not supported by the server.</p>
<p>506 Variant Also Negotiates<br>The server has an internal configuration error: the chosen variant resource is configured to engage in transparent content negotiation itself, and is therefore not a proper end point in the negotiation process.</p>
<p>507 Insufficient Storage (WebDAV)<br>The method could not be performed on the resource because the server is unable to store the representation needed to successfully complete the request.</p>
<p>508 Loop Detected (WebDAV)<br>The server detected an infinite loop while processing the request.</p>
<p>510 Not Extended<br>Further extensions to the request are required for the server to fulfill it.</p>
<p>511 Network Authentication Required<br>Indicates that the client needs to authenticate to gain network access.</p>
<hr>
<p>response header</p>
<p>content-type:<br>application&#x2F;x-javascript –&gt; javascirpt file</p>
<h3 id="web-基础"><a href="#web-基础" class="headerlink" title="web 基础"></a>web 基础</h3><p>html css js</p>
<p>html dom<br>document object model<br><img src="/assets/images/python_3_web_scraping_cuiqincai/image-1.png" alt="Alt text"></p>
<hr>
<p>css selector</p>
<table>
<thead>
<tr>
<th>Selector</th>
<th>Example</th>
<th>Example description</th>
</tr>
</thead>
<tbody><tr>
<td>.class</td>
<td>.intro</td>
<td>Selects all elements with class&#x3D;”intro”</td>
</tr>
<tr>
<td>.class1.class2</td>
<td>.name1.name2</td>
<td>Selects all elements with both name1 and name2 set within its class attribute</td>
</tr>
<tr>
<td>.class1 .class2</td>
<td>.name1 .name2</td>
<td>Selects all elements with name2 that is a descendant of an element with name1</td>
</tr>
<tr>
<td>#id</td>
<td>#firstname</td>
<td>Selects the element with id&#x3D;”firstname”</td>
</tr>
<tr>
<td>*</td>
<td>*</td>
<td>Selects all elements</td>
</tr>
<tr>
<td>element</td>
<td>p</td>
<td>Selects all <code>&lt;p&gt;</code> elements</td>
</tr>
<tr>
<td>element.class</td>
<td>p.intro</td>
<td>Selects all <code>&lt;p&gt;</code> elements with class&#x3D;”intro”</td>
</tr>
<tr>
<td>element,element</td>
<td>div, p</td>
<td>Selects all <code>&lt;div&gt;</code> elements and all <code>&lt;p&gt;</code> elements</td>
</tr>
<tr>
<td>element element</td>
<td>div p</td>
<td>Selects all <code>&lt;p&gt;</code> elements inside <code>&lt;div&gt;</code> elements</td>
</tr>
<tr>
<td>element&gt;element</td>
<td>div &gt; p</td>
<td>Selects all <code>&lt;p&gt;</code> elements where the parent is a <code>&lt;div&gt;</code> element</td>
</tr>
<tr>
<td>element+element</td>
<td>div + p</td>
<td>Selects the first <code>&lt;p&gt;</code> element that is placed immediately after <code>&lt;div&gt;</code> elements</td>
</tr>
<tr>
<td>element1~element2</td>
<td>p ~ ul</td>
<td>Selects every <code>&lt;ul&gt;</code> element that is preceded by a <code>&lt;p&gt;</code> element</td>
</tr>
<tr>
<td>[attribute]</td>
<td>[target]</td>
<td>Selects all elements with a target attribute</td>
</tr>
<tr>
<td>[attribute&#x3D;value]</td>
<td>[target&#x3D;”_blank”]</td>
<td>Selects all elements with target&#x3D;”_blank”</td>
</tr>
<tr>
<td>[attribute~&#x3D;value]</td>
<td>[title~&#x3D;”flower”]</td>
<td>Selects all elements with a title attribute containing the word “flower”</td>
</tr>
<tr>
<td>[attribute|&#x3D;value]</td>
<td>[lang|&#x3D;”en”]</td>
<td>Selects all elements with a lang attribute value equal to “en” or starting with “en-“</td>
</tr>
<tr>
<td>[attribute^&#x3D;value]</td>
<td>a[href^&#x3D;”https”]</td>
<td>Selects every <code>&lt;a&gt;</code> element whose href attribute value begins with “https”</td>
</tr>
<tr>
<td>[attribute$&#x3D;value]</td>
<td>a[href$&#x3D;”.pdf”]</td>
<td>Selects every <code>&lt;a&gt;</code> element whose href attribute value ends with “.pdf”</td>
</tr>
<tr>
<td>[attribute*&#x3D;value]</td>
<td>a[href*&#x3D;”w3schools”]</td>
<td>Selects every <code>&lt;a&gt;</code> element whose href attribute value contains the substring “w3schools”</td>
</tr>
<tr>
<td>:active</td>
<td>a:active</td>
<td>Selects the active link</td>
</tr>
<tr>
<td>::after</td>
<td>p::after</td>
<td>Insert something after the content of each <code>&lt;p&gt;</code> element</td>
</tr>
<tr>
<td>::before</td>
<td>p::before</td>
<td>Insert something before the content of each <code>&lt;p&gt;</code> element</td>
</tr>
<tr>
<td>:checked</td>
<td>input:checked</td>
<td>Selects every checked <code>&lt;input&gt;</code> element</td>
</tr>
<tr>
<td>:default</td>
<td>input:default</td>
<td>Selects the default <code>&lt;input&gt;</code> element</td>
</tr>
<tr>
<td>:disabled</td>
<td>input:disabled</td>
<td>Selects every disabled <code>&lt;input&gt;</code> element</td>
</tr>
<tr>
<td>:empty</td>
<td>p:empty</td>
<td>Selects every <code>&lt;p&gt;</code> element that has no children (including text nodes)</td>
</tr>
<tr>
<td>:enabled</td>
<td>input:enabled</td>
<td>Selects every enabled <code>&lt;input&gt;</code> element</td>
</tr>
<tr>
<td>:first-child</td>
<td>p:first-child</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the first child of its parent</td>
</tr>
<tr>
<td>::first-letter</td>
<td>p::first-letter</td>
<td>Selects the first letter of every <code>&lt;p&gt;</code> element</td>
</tr>
<tr>
<td>::first-line</td>
<td>p::first-line</td>
<td>Selects the first line of every <code>&lt;p&gt;</code> element</td>
</tr>
<tr>
<td>:first-of-type</td>
<td>p:first-of-type</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the first <code>&lt;p&gt;</code> element of its parent</td>
</tr>
<tr>
<td>:focus</td>
<td>input:focus</td>
<td>Selects the input element which has focus</td>
</tr>
<tr>
<td>:fullscreen</td>
<td>:fullscreen</td>
<td>Selects the element that is in full-screen mode</td>
</tr>
<tr>
<td>:hover</td>
<td>a:hover</td>
<td>Selects links on mouse over</td>
</tr>
<tr>
<td>:in-range</td>
<td>input:in-range</td>
<td>Selects input elements with a value within a specified range</td>
</tr>
<tr>
<td>:indeterminate</td>
<td>input:indeterminate</td>
<td>Selects input elements that are in an indeterminate state</td>
</tr>
<tr>
<td>:invalid</td>
<td>input:invalid</td>
<td>Selects all input elements with an invalid value</td>
</tr>
<tr>
<td>:lang(language)</td>
<td>p:lang(it)</td>
<td>Selects every <code>&lt;p&gt;</code> element with a lang attribute equal to “it” (Italian)</td>
</tr>
<tr>
<td>:last-child</td>
<td>p:last-child</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the last child of its parent</td>
</tr>
<tr>
<td>:last-of-type</td>
<td>p:last-of-type</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the last <code>&lt;p&gt;</code> element of its parent</td>
</tr>
<tr>
<td>:link</td>
<td>a:link</td>
<td>Selects all unvisited links</td>
</tr>
<tr>
<td>::marker</td>
<td>::marker</td>
<td>Selects the markers of list items</td>
</tr>
<tr>
<td>:not(selector)</td>
<td>:not(p)</td>
<td>Selects every element that is not a <code>&lt;p&gt;</code> element</td>
</tr>
<tr>
<td>:nth-child(n)</td>
<td>p:nth-child(2)</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the second child of its parent</td>
</tr>
<tr>
<td>:nth-last-child(n)</td>
<td>p:nth-last-child(2)</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the second child of its parent, counting from the last child</td>
</tr>
<tr>
<td>:nth-last-of-type(n)</td>
<td>p:nth-last-of-type(2)</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the second <code>&lt;p&gt;</code> element of its parent, counting from the last child</td>
</tr>
<tr>
<td>:nth-of-type(n)</td>
<td>p:nth-of-type(2)</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the second <code>&lt;p&gt;</code> element of its parent</td>
</tr>
<tr>
<td>:only-of-type</td>
<td>p:only-of-type</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the only <code>&lt;p&gt;</code> element of its parent</td>
</tr>
<tr>
<td>:only-child</td>
<td>p:only-child</td>
<td>Selects every <code>&lt;p&gt;</code> element that is the only child of its parent</td>
</tr>
<tr>
<td>:optional</td>
<td>input:optional</td>
<td>Selects input elements with no “required” attribute</td>
</tr>
<tr>
<td>:out-of-range</td>
<td>input:out-of-range</td>
<td>Selects input elements with a value outside a specified range</td>
</tr>
<tr>
<td>::placeholder</td>
<td>input::placeholder</td>
<td>Selects input elements with the “placeholder” attribute specified</td>
</tr>
<tr>
<td>:read-only</td>
<td>input:read-only</td>
<td>Selects input elements with the “readonly” attribute specified</td>
</tr>
<tr>
<td>:read-write</td>
<td>input:read-write</td>
<td>Selects input elements with the “readonly” attribute NOT specified</td>
</tr>
<tr>
<td>:required</td>
<td>input:required</td>
<td>Selects input elements with the “required” attribute specified</td>
</tr>
<tr>
<td>:root</td>
<td>:root</td>
<td>Selects the document’s root element</td>
</tr>
<tr>
<td>::selection</td>
<td>::selection</td>
<td>Selects the portion of an element that is selected by a user</td>
</tr>
<tr>
<td>:target</td>
<td>#news:target</td>
<td>Selects the current active #news element (clicked on a URL containing that anchor name)</td>
</tr>
<tr>
<td>:valid</td>
<td>input:valid</td>
<td>Selects all input elements with a valid value</td>
</tr>
<tr>
<td>:visited</td>
<td>a:visited</td>
<td>Selects all visited links</td>
</tr>
</tbody></table>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line">resp = urlopen(url)</span><br><span class="line">html_body = resp.read().decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;mybaidu.html&quot;</span>, mode=<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(html_body)</span><br><span class="line"><span class="comment"># resp.close()</span></span><br></pre></td></tr></table></figure>

<p>服务器渲染</p>
<p>在没有AJAX的时候，也就是web1.0时代，几乎所有应用都是服务端渲染（此时服务器渲染非现在的服务器渲染），那个时候的页面渲染大概是这样的，浏览器请求页面URL，然后服务器接收到请求之后，到数据库查询数据，将数据丢到后端的组件模板（php、asp、jsp等）中，并渲染成HTML片段，接着服务器在组装这些HTML片段，组成一个完整的HTML，最后返回给浏览器，这个时候，浏览器已经拿到了一个完整的被服务器动态组装出来的HTML文本，然后将HTML渲染到页面中</p>
<p><img src="/assets/images/xiaoyuan_python/image.png" alt="Alt text"></p>
<p>客户端渲染<br>前后端分离之后，网页开始被当成了独立的应用程序（SPA，Single Page Application），前端团队接管了所有页面渲染的事，后端团队只负责提供所有数据查询与处理的API，大体流程是这样的：首先浏览器请求URL，前端服务器直接返回一个空的静态HTML文件（不需要任何查数据库和模板组装），这个HTML文件中加载了很多渲染页面需要的 JavaScript 脚本和 CSS 样式表，浏览器拿到 HTML 文件后开始加载脚本和样式表，并且执行脚本，这个时候脚本请求后端服务提供的API，获取数据，获取完成后将数据通过JavaScript脚本动态的将数据渲染到页面中，完成页面显示。</p>
<p><img src="/assets/images/xiaoyuan_python/image-1.png" alt="Alt text"></p>
<p>服务端渲染<br>服务端渲染。大体流程与客户端渲染有些相似，首先是浏览器请求URL，前端服务器接收到URL请求之后，根据不同的URL，前端服务器向后端服务器请求数据，请求完成后，前端服务器会组装一个携带了具体数据的HTML文本，并且返回给浏览器，浏览器得到HTML之后开始渲染页面，同时，浏览器加载并执行 JavaScript 脚本，给页面上的元素绑定事件，让页面变得可交互，当用户与浏览器页面进行交互，如跳转到下一个页面时，浏览器会执行 JavaScript 脚本，向后端服务器请求数据，获取完数据之后再次执行 JavaScript 代码动态渲染页面。</p>
<p><img src="/assets/images/xiaoyuan_python/image-2.png" alt="Alt text"></p>
<p>响应头</p>
<ul>
<li>cookie</li>
<li>token</li>
</ul>
<p>请求头</p>
<ul>
<li>user-agent</li>
<li>referer请求从那一页面来的（即上一页面地址）</li>
<li>cookie</li>
</ul>
<p>GET<br>POST</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url =<span class="string">&quot;https://sogou.com/web?query=周杰伦&quot;</span></span><br><span class="line"></span><br><span class="line">my_headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">resp = requests.get(url, headers=my_headers)</span><br><span class="line"><span class="built_in">print</span>(resp)</span><br><span class="line">html_resp = resp.text</span><br><span class="line"><span class="built_in">print</span>(html_resp)</span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://fanyi.baidu.com/sug&quot;</span></span><br><span class="line">word = <span class="built_in">input</span>(<span class="string">&quot;english world: &quot;</span>)</span><br><span class="line">dat = &#123;</span><br><span class="line">    <span class="string">&quot;kw&quot;</span>: word</span><br><span class="line">&#125;</span><br><span class="line">resp = requests.post(url, data=dat)</span><br><span class="line"><span class="built_in">print</span>(resp.json())</span><br><span class="line">resp.close()</span><br></pre></td></tr></table></figure>

<h2 id="string"><a href="#string" class="headerlink" title="string"></a>string</h2><h3 id="the-most-common-string-methods"><a href="#the-most-common-string-methods" class="headerlink" title="the most common string methods"></a>the most common string methods</h3><ul>
<li>s.lower(), s.upper() – returns the lowercase or uppercase version of the string</li>
<li>s.strip() – returns a string with whitespace removed from the start and end</li>
<li>s.isalpha()&#x2F;s.isdigit()&#x2F;s.isspace()… – tests if all the string chars are in the various character classes</li>
<li>s.startswith(‘other’), s.endswith(‘other’) – tests if the string starts or ends with the given other string</li>
<li>s.find(‘other’) – searches for the given other string (not a regular expression) within s, and returns the first index where it begins or -1 if not found</li>
<li>s.replace(‘old’, ‘new’) – returns a string where all occurrences of ‘old’ have been replaced by ‘new’</li>
<li>s.split(‘delim’) – returns a list of substrings separated by the given delimiter. The delimiter is not a regular expression, it’s just text. ‘aaa,bbb,ccc’.split(‘,’) -&gt; [‘aaa’, ‘bbb’, ‘ccc’]. As a convenient special case s.split() (with no arguments) splits on all whitespace chars.</li>
<li>s.join(list) – opposite of split(), joins the elements in the given list together using the string as the delimiter. e.g. ‘—‘.join([‘aaa’, ‘bbb’, ‘ccc’]) -&gt; aaa—bbb—ccc</li>
</ul>
<p><code>str.rsplit(sep=None, maxsplit=-1)</code><br>Return a list of the words in the string, using sep as the delimiter string. If maxsplit is given, at most maxsplit splits are done, the rightmost ones. If sep is not specified or None, any whitespace string is a separator. Except for splitting from the right, rsplit() behaves like split() which is described in detail below.</p>
<p><code>str.split(sep=None, maxsplit=- 1)</code><br>Return a list of the words in the string, using sep as the delimiter string. If maxsplit is given, at most maxsplit splits are done (thus, the list will have at most maxsplit+1 elements). If maxsplit is not specified or -1, then there is no limit on the number of splits (all possible splits are made).</p>
<p>If sep is given, consecutive delimiters are not grouped together and are deemed to delimit empty strings (for example, <code>&#39;1,,2&#39;.split(&#39;,&#39;)</code> returns <code>[&#39;1&#39;, &#39;&#39;, &#39;2&#39;]</code>). The sep argument may consist of multiple characters (for example, <code>&#39;1&lt;&gt;2&lt;&gt;3&#39;.split(&#39;&lt;&gt;&#39;)</code> returns<code>[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;]</code>). Splitting an empty string with a specified separator returns [‘’].</p>
<h3 id="Strings-Unicode-vs-bytes"><a href="#Strings-Unicode-vs-bytes" class="headerlink" title="Strings (Unicode vs bytes)"></a>Strings (Unicode vs bytes)</h3><p>To convert a regular Python string to bytes, call the encode() method on the string. Going the other direction, the byte string decode() method converts encoded plain bytes to a unicode string:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; ustring = <span class="string">&#x27;A unicode \u018e string \xf1&#x27;</span></span><br><span class="line">&gt; b = ustring.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">&gt; b</span><br><span class="line">b<span class="string">&#x27;A unicode \xc6\x8e string \xc3\xb1&#x27;</span>  <span class="comment">## bytes of utf-8 encoding. Note the b-prefix.</span></span><br><span class="line">&gt; t = b.decode(<span class="string">&#x27;utf-8&#x27;</span>)                <span class="comment">## Convert bytes back to a unicode string</span></span><br><span class="line">&gt; t == ustring                         <span class="comment">## It&#x27;s the same as the original, yay!</span></span><br><span class="line">True</span><br></pre></td></tr></table></figure>


<h2 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line">url_1 = <span class="string">&#x27;http://www.baidu.com/&#x27;</span></span><br><span class="line">resp = request.urlopen(url_1)</span><br><span class="line"><span class="built_in">print</span>(resp)</span><br><span class="line"></span><br><span class="line">real_url = resp.geturl()</span><br><span class="line"><span class="built_in">print</span>(real_url)  <span class="comment"># http://www.baidu.com/</span></span><br><span class="line"></span><br><span class="line">resp_code = resp.getcode()</span><br><span class="line"><span class="built_in">print</span>(resp_code)  <span class="comment"># 200</span></span><br><span class="line"></span><br><span class="line">html_source_bytes = resp.read()  <span class="comment"># 字节串</span></span><br><span class="line">html_source = html_source_bytes.decode()  <span class="comment"># 字符串</span></span><br><span class="line"><span class="built_in">print</span>(html_source)</span><br></pre></td></tr></table></figure>

<h4 id="urllib-request-headers"><a href="#urllib-request-headers" class="headerlink" title="urllib.request headers"></a>urllib.request headers</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">url_1 = <span class="string">&#x27;http://httpbin.org/get&#x27;</span></span><br><span class="line">my_header = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req = request.Request(url=url_1, headers=my_header)</span><br><span class="line"></span><br><span class="line">resp = request.urlopen(req)</span><br><span class="line"></span><br><span class="line">html_source_bytes = resp.read()  <span class="comment"># 字节串</span></span><br><span class="line">html_source = html_source_bytes.decode()  <span class="comment"># 字符串</span></span><br><span class="line"><span class="built_in">print</span>(html_source)</span><br></pre></td></tr></table></figure>

<h4 id="urllib-parse-urlencode"><a href="#urllib-parse-urlencode" class="headerlink" title="urllib.parse.urlencode"></a>urllib.parse.urlencode</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对URL编码</span></span><br><span class="line"><span class="comment"># https://www.baidu.com/s?wd=%E8%B5%B5%E4%B8%BD%E9%A2%96</span></span><br><span class="line"><span class="comment"># https://www.baidu.com/s?wd=赵丽颖</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse, request</span><br><span class="line"></span><br><span class="line">url_1 = <span class="string">&#x27;http://www.baidu.com/s?&#x27;</span></span><br><span class="line">params_1 = &#123;</span><br><span class="line">    <span class="string">&#x27;wd&#x27;</span>: <span class="string">&#x27;赵丽颖&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ie&#x27;</span>: <span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Encode a dict or sequence of two-element tuples into a URL query string</span></span><br><span class="line">params_encoded = parse.urlencode(params_1)</span><br><span class="line">url_0 = url_1 + params_encoded</span><br><span class="line"><span class="built_in">print</span>(url_0)</span><br><span class="line"><span class="comment"># http://www.baidu.com/s?wd=%E8%B5%B5%E4%B8%BD%E9%A2%96&amp;ie=utf-8</span></span><br><span class="line"><span class="comment"># request.urlopen(url_0)</span></span><br></pre></td></tr></table></figure>

<h4 id="example-baidutieba"><a href="#example-baidutieba" class="headerlink" title="example: baidutieba"></a>example: baidutieba</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, parse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaiduTiebaSpider</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.base_url = <span class="string">&#x27;https://tieba.baidu.com/f?&#x27;</span></span><br><span class="line">        self.params = &#123;</span><br><span class="line">            <span class="string">&quot;kw&quot;</span>: <span class="string">&quot;赵丽颖吧&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ie&quot;</span>: <span class="string">&quot;utf-8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;pn&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        self.my_header = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.data_folder = <span class="string">&#x27;baidutieba_data&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_html</span>(<span class="params">self, url</span>):</span><br><span class="line">        req = request.Request(url, headers=self.my_header)</span><br><span class="line">        resp = request.urlopen(req)</span><br><span class="line">        html_source = resp.read().decode()</span><br><span class="line">        <span class="keyword">return</span> html_source</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_html</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_html</span>(<span class="params">self, filename, content</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        name = <span class="built_in">input</span>(<span class="string">&#x27;tieba name:&#x27;</span>)</span><br><span class="line">        start_page = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;start page:&#x27;</span>))</span><br><span class="line">        end_page = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;end page:&#x27;</span>))</span><br><span class="line">        self.params[<span class="string">&#x27;kw&#x27;</span>] = name</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(start_page, end_page + <span class="number">1</span>):</span><br><span class="line">            self.params[<span class="string">&#x27;pn&#x27;</span>] = (page -<span class="number">1</span>) * <span class="number">50</span></span><br><span class="line">            params_encode = parse.urlencode(self.params)</span><br><span class="line">            url_0 = self.base_url + params_encode</span><br><span class="line">            html_content = self.get_html(url_0)</span><br><span class="line">            self.save_html(<span class="string">f&#x27;<span class="subst">&#123;self.data_folder&#125;</span>/<span class="subst">&#123;name&#125;</span>_page_<span class="subst">&#123;page&#125;</span>.html&#x27;</span>,html_content)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;page <span class="subst">&#123;page&#125;</span> finished!&#x27;</span>)</span><br><span class="line">            time.sleep(random.randint(<span class="number">1</span>, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    spider = BaiduTiebaSpider()</span><br><span class="line">    spider.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h2><p><code>import requests</code></p>
<h3 id="headers"><a href="#headers" class="headerlink" title="headers"></a>headers</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requests.get(url, headers=headers)</span><br></pre></td></tr></table></figure>

<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&#x27;key1&#x27;</span>: <span class="string">&#x27;value1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## verify = True ## False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### timeout</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## proxies</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://IP:PORT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;https://IP:PORT&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp = request(url, params=params, verify=<span class="literal">False</span>, timeout=<span class="number">5</span>, proxies=proxies)</span><br></pre></td></tr></table></figure>

<h3 id="post"><a href="#post" class="headerlink" title="post"></a>post</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;key1&#x27;</span>: <span class="string">&#x27;value1&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requests.post(url, data=data)</span><br></pre></td></tr></table></figure>

<h3 id="response"><a href="#response" class="headerlink" title="response"></a>response</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">resp = requests.get(url)</span><br><span class="line"></span><br><span class="line">resp.decoding = <span class="string">&quot;utf-8&quot;</span></span><br><span class="line">resp.text   <span class="comment">## html</span></span><br><span class="line"></span><br><span class="line">resp.content  <span class="comment">## b&#x27;asdfdsf&#x27;</span></span><br><span class="line">resp.content.decode()</span><br><span class="line"></span><br><span class="line">resp.json() <span class="comment"># json字符串 -&gt; python dict</span></span><br><span class="line">dic = json.loads(resp.text) <span class="comment"># json字符串 -&gt; python dict</span></span><br></pre></td></tr></table></figure>

<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><h3 id="re"><a href="#re" class="headerlink" title="re"></a>re</h3><ul>
<li>Method&#x2F;Attribute Purpose</li>
</ul>
<p>match()<br>Determine if the RE matches at the beginning of the string.</p>
<p>search()<br>Scan through a string, looking for any location where this RE matches.</p>
<p>findall()<br>Find all substrings where the RE matches, and returns them as a list.</p>
<p>finditer()<br>Find all substrings where the RE matches, and returns them as an iterator.</p>
<ul>
<li>Match object instances</li>
</ul>
<p>group()<br>Return the string matched by the RE</p>
<p>Method&#x2F;Attribute Purpose</p>
<p>start()<br>Return the starting position of the match</p>
<p>end()<br>Return the ending position of the match</p>
<p>span()<br>Return a tuple containing the (start, end) positions of the match</p>
<ul>
<li>Compilation flags let you modify some aspects of how regular expressions work. Flags are available in the re module under two names, a long name such as IGNORECASE and a short, one-letter form such as I</li>
</ul>
<p>re.S<br>re.DOTALL<br>Makes the ‘.’ special character match any character at all, including a newline; without this flag, ‘.’ will match anything except a newline.</p>
<ul>
<li>named groups: instead of referring to them by numbers, groups can be referenced by a name.<br>The syntax for a named group is one of the Python-specific extensions: <code>(?P&lt;name&gt;...)</code>. name is, obviously, the name of the group.</li>
</ul>
<p>The match object methods that deal with capturing groups all accept either integers that refer to the group by number or strings that contain the desired group’s name.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?P&lt;word&gt;\b\w+\b)&#x27;</span>)</span><br><span class="line">m = p.search( <span class="string">&#x27;(((( Lots of punctuation )))&#x27;</span> )</span><br><span class="line">m.group(<span class="string">&#x27;word&#x27;</span>)</span><br><span class="line"><span class="comment"># &#x27;Lots&#x27;</span></span><br><span class="line">m.group(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># &#x27;Lots&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">result_list = re.findall(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;我的电话号码是：10086&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result_list)</span><br></pre></td></tr></table></figure>

<p>效率不高</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  iterator</span></span><br><span class="line">it = re.finditer(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;我的电话号码是：10086&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> it:</span><br><span class="line">    <span class="built_in">print</span>(i.group())</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># match object group() return the first result</span></span><br><span class="line">s = re.search(<span class="string">r&quot;\d+&quot;</span>, <span class="string">&quot;我的电话号码是：10086，我女友的电话是：10010&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(s.group())</span><br></pre></td></tr></table></figure>

<hr>
<p>正则预加载</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&quot;\d+&quot;</span>)</span><br><span class="line"></span><br><span class="line">it = obj.finditer(<span class="string">&quot;10086，我女友的电话是：10010&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> it:</span><br><span class="line">    <span class="built_in">print</span>(i.group())</span><br></pre></td></tr></table></figure>

<p>提取字符段</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取字符段</span></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jay&#x27;&gt;&lt;span id=&#x27;1&#x27;&gt;郭麒麟&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jj&#x27;&gt;&lt;span id=&#x27;2&#x27;&gt;宋铁&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&#x27;jolin&#x27;&gt;&lt;span id=&#x27;3&#x27;&gt;大聪明&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># re.S 让.能匹配换行符</span></span><br><span class="line">obj = re.<span class="built_in">compile</span>(<span class="string">r&quot;&lt;div class=&#x27;.*?&#x27;&gt;&lt;span id=&#x27;(?P&lt;id&gt;\d+)&#x27;&gt;(?P&lt;name&gt;.*?)&lt;/span&gt;&lt;/div&gt;&quot;</span>, re.S)</span><br><span class="line"></span><br><span class="line">result = obj.finditer(s)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(it.group(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(it.group(<span class="string">&quot;id&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>Python 3 the file must be opened in untranslated text mode with the parameters <code>&#39;w&#39;, newline=&#39;&#39;</code>(empty string) or it will write \r\r\n on Windows, where the default text mode will translate each \n into \r\n.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line">it = obj.finditer(html_content)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data05.csv&quot;</span>, mode=<span class="string">&quot;w&quot;</span>, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    csvwriter = csv.writer(f)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> it:</span><br><span class="line">        dic = i.groupdict()</span><br><span class="line">        dic[<span class="string">&quot;year&quot;</span>] = dic[<span class="string">&#x27;year&#x27;</span>].strip()</span><br><span class="line">        <span class="built_in">print</span>(dic.values())</span><br><span class="line">        csvwriter.writerow(dic.values())</span><br></pre></td></tr></table></figure>

<h3 id="re-1"><a href="#re-1" class="headerlink" title="re"></a>re</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">&#x27;ADBABDF ABVA BVAAB&#x27;</span></span><br><span class="line">r_list = re.findall(<span class="string">r&#x27;AB&#x27;</span>, content, re.S)</span><br><span class="line"><span class="built_in">print</span>(r_list)  <span class="comment"># [&#x27;AB&#x27;, &#x27;AB&#x27;, &#x27;AB&#x27;]</span></span><br><span class="line"></span><br><span class="line">re_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;AB&#x27;</span>, re.S)</span><br><span class="line">result = re_pattern.findall(content)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># [&#x27;AB&#x27;, &#x27;AB&#x27;, &#x27;AB&#x27;]</span></span><br></pre></td></tr></table></figure>

<h5 id="“-”"><a href="#“-”" class="headerlink" title="“?”"></a>“?”</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">html_content = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;div&gt;&lt;p&gt;hello world&lt;/p&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;&lt;p&gt;hello world!&lt;/p&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">re_pattern_1 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;div&gt;&lt;p&gt;.*&lt;/p&gt;&lt;/div&gt;&#x27;</span>, re.S)</span><br><span class="line">result_1 = re_pattern_1.findall(html_content)</span><br><span class="line"><span class="built_in">print</span>(result_1)  <span class="comment"># [&#x27;&lt;div&gt;&lt;p&gt;hello world&lt;/p&gt;&lt;/div&gt;\n&lt;div&gt;&lt;p&gt;hello world!&lt;/p&gt;&lt;/div&gt;&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">re_pattern_2 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;div&gt;&lt;p&gt;.*?&lt;/p&gt;&lt;/div&gt;&#x27;</span>, re.S)</span><br><span class="line">result_2 = re_pattern_2.findall(html_content)</span><br><span class="line"><span class="built_in">print</span>(result_2)  <span class="comment"># [&#x27;&lt;div&gt;&lt;p&gt;hello world&lt;/p&gt;&lt;/div&gt;&#x27;, &#x27;&lt;div&gt;&lt;p&gt;hello world!&lt;/p&gt;&lt;/div&gt;&#x27;]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="group"><a href="#group" class="headerlink" title="group"></a>group</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="string">&#x27;A B C D&#x27;</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\w+\s+\w+&#x27;</span>)</span><br><span class="line">r_list = pattern.findall(html)</span><br><span class="line"><span class="built_in">print</span>(r_list)  <span class="comment"># [&#x27;A B&#x27;, &#x27;C D&#x27;]</span></span><br><span class="line"></span><br><span class="line">html = <span class="string">&#x27;A B C D&#x27;</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\w+)\s+\w+&#x27;</span>)</span><br><span class="line">r_list = pattern.findall(html)</span><br><span class="line"><span class="built_in">print</span>(r_list)  <span class="comment"># [&#x27;A&#x27;, &#x27;C&#x27;]</span></span><br><span class="line"></span><br><span class="line">html = <span class="string">&#x27;A B C D&#x27;</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\w+)\s+(\w+)&#x27;</span>)</span><br><span class="line">r_list = pattern.findall(html)</span><br><span class="line"><span class="built_in">print</span>(r_list)  <span class="comment"># [(&#x27;A&#x27;, &#x27;B&#x27;), (&#x27;C&#x27;, &#x27;D&#x27;)]</span></span><br></pre></td></tr></table></figure>

<h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;div class=&quot;animal&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p class=&quot;name&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;&quot; title=&quot;Tiger&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p class=&quot;content&quot;&gt;</span></span><br><span class="line"><span class="string">        two tigers two tigers run fast</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class=&quot;animal&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p class=&quot;name&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;&quot; title=&quot;Rabbit&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p class=&quot;content&quot;&gt;</span></span><br><span class="line"><span class="string">        small white rabbit white and white</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">re_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;div class=&quot;animal&quot;&gt;.*?&lt;a title=&quot;(.*?)&quot;.*?&lt;p class=&quot;content&quot;&gt;(.*?)&lt;/p&gt;.*?&lt;/div&gt;&#x27;</span>, re.S)</span><br><span class="line">tuple_s = re_pattern.findall(html)</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> tuple_s:</span><br><span class="line">    result_1 = t[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(result_1)</span><br><span class="line">    result_2 = t[<span class="number">1</span>].strip()</span><br><span class="line">    <span class="built_in">print</span>(result_2)</span><br></pre></td></tr></table></figure>

<h4 id="example-maoyan-com"><a href="#example-maoyan-com" class="headerlink" title="example: maoyan.com"></a>example: maoyan.com</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MaoyanSpider</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.base_url = <span class="string">&#x27;https://movie.douban.com/top250?start=&#x27;</span></span><br><span class="line">        self.start = <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        self.my_header = &#123;</span><br><span class="line">            <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;https://movie.douban.com/top250&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.data_folder = <span class="string">&#x27;douban_data&#x27;</span></span><br><span class="line"></span><br><span class="line">        self.f = <span class="built_in">open</span>(<span class="string">&#x27;douban_data/douban.csv&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        self.writer = csv.writer(self.f)</span><br><span class="line">        <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_html</span>(<span class="params">self, url</span>):</span><br><span class="line">        req = request.Request(url, headers=self.my_header)</span><br><span class="line">        resp = request.urlopen(req)</span><br><span class="line">        html_source = resp.read().decode()</span><br><span class="line">        <span class="keyword">return</span> html_source</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_html</span>(<span class="params">self, html_content</span>):</span><br><span class="line">        regex = <span class="string">r&quot;&quot;&quot;&lt;div class=&quot;info&quot;&gt;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;title&gt;.*?)&lt;/span&gt;.*?&lt;p.*?&gt;(?P&lt;people&gt;.*?)&lt;br&gt;(?P&lt;meta_1&gt;.*?)&lt;/p&gt;.*?&lt;span class=&quot;rating_num&quot;.*?&gt;(?P&lt;stars&gt;.*?)&lt;/span&gt;.*?&lt;span&gt;(?P&lt;comments_n&gt;.*?)&lt;/span&gt;&quot;&quot;&quot;</span></span><br><span class="line">        re_pattern =re.<span class="built_in">compile</span>(regex, re.S)</span><br><span class="line">        r_list = re_pattern.findall(html_content)</span><br><span class="line">        <span class="keyword">return</span> r_list</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_html</span>(<span class="params">self, r_list</span>):</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> r_list:</span><br><span class="line">            l = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(r)):</span><br><span class="line">                l.append(r[i].strip())</span><br><span class="line">            self.writer.writerow(l)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            self.start = <span class="built_in">str</span>(page * <span class="number">25</span>)</span><br><span class="line">            url_0 = self.base_url + self.start</span><br><span class="line">            html_content = self.get_html(url_0)</span><br><span class="line">            r_list = self.parse_html(html_content)</span><br><span class="line">            self.save_html(r_list)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;page <span class="subst">&#123;page&#125;</span> finished!&#x27;</span>)</span><br><span class="line">            time.sleep(random.randint(<span class="number">1</span>, <span class="number">3</span>))</span><br><span class="line">        self.f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    spider = MaoyanSpider()</span><br><span class="line">    spider.run()</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MaoyanSpider</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.base_url = <span class="string">&#x27;https://movie.douban.com/top250?start=&#x27;</span></span><br><span class="line">        self.start = <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        self.my_header = &#123;</span><br><span class="line">            <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;https://movie.douban.com/top250&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.data_folder = <span class="string">&#x27;douban_data&#x27;</span></span><br><span class="line"></span><br><span class="line">        self.data = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_html</span>(<span class="params">self, url</span>):</span><br><span class="line">        req = request.Request(url, headers=self.my_header)</span><br><span class="line">        resp = request.urlopen(req)</span><br><span class="line">        html_source = resp.read().decode()</span><br><span class="line">        <span class="keyword">return</span> html_source</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_html</span>(<span class="params">self, html_content</span>):</span><br><span class="line">        regex = <span class="string">r&quot;&quot;&quot;&lt;div class=&quot;info&quot;&gt;.*?&lt;span class=&quot;title&quot;&gt;(?P&lt;title&gt;.*?)&lt;/span&gt;.*?&lt;p.*?&gt;(?P&lt;people&gt;.*?)&lt;br&gt;(?P&lt;meta_1&gt;.*?)&lt;/p&gt;.*?&lt;span class=&quot;rating_num&quot;.*?&gt;(?P&lt;stars&gt;.*?)&lt;/span&gt;.*?&lt;span&gt;(?P&lt;comments_n&gt;.*?)&lt;/span&gt;&quot;&quot;&quot;</span></span><br><span class="line">        re_pattern =re.<span class="built_in">compile</span>(regex, re.S)</span><br><span class="line">        r_list = re_pattern.findall(html_content)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> r_list:</span><br><span class="line">            l = []</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(r)):</span><br><span class="line">                l.append(r[i].strip())</span><br><span class="line">            self.data.append(l)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_html</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># for r in r_list:</span></span><br><span class="line">        <span class="comment">#     data_row = list(r)</span></span><br><span class="line">        <span class="comment">#     print(data_row)</span></span><br><span class="line">        <span class="comment">#     with open(filename, &#x27;a&#x27;, newline=&#x27;&#x27;) as f:</span></span><br><span class="line">        <span class="comment">#         csv_writer = csv.writer(f)</span></span><br><span class="line">        <span class="comment">#         csv_writer.writerow(data_row)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># with open(filename, &#x27;a&#x27;, newline=&#x27;&#x27;) as f:</span></span><br><span class="line">        <span class="comment">#     csv_writer = csv.writer(f)</span></span><br><span class="line">        <span class="comment">#     csv_writer.writerows(r_list)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;douban_data/douban.csv&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            writer = csv.writer(f)</span><br><span class="line">            writer.writerows(self.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            self.start = <span class="built_in">str</span>(page * <span class="number">25</span>)</span><br><span class="line">            url_0 = self.base_url + self.start</span><br><span class="line">            html_content = self.get_html(url_0)</span><br><span class="line">            self.parse_html(html_content)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;page <span class="subst">&#123;page&#125;</span> finished!&#x27;</span>)</span><br><span class="line">            time.sleep(random.randint(<span class="number">1</span>, <span class="number">3</span>))</span><br><span class="line">        self.save_html()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    spider = MaoyanSpider()</span><br><span class="line">    spider.run()</span><br></pre></td></tr></table></figure>

<h4 id="example-baidu-image"><a href="#example-baidu-image" class="headerlink" title="example: baidu image"></a>example: baidu image</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaiduImageSpider</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.url = <span class="string">&quot;https://image.baidu.com/search/index?&quot;</span></span><br><span class="line">        self.my_header = &#123;</span><br><span class="line">            <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;https://www.baidu.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.cookies = &#123;</span><br><span class="line">            <span class="string">&#x27;BIDUPSID&#x27;</span>: <span class="string">&#x27;08BC8B371D41816A15AD22D8AC4405C2&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;BDRCVFR[dG2JNJb_ajR]&#x27;</span>: <span class="string">&#x27;mk3SLVN4HKm&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;BAIDUID&#x27;</span>: <span class="string">&#x27;08BC8B371D41816A13367C0125B857DA:FG=1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;userFrom&#x27;</span>: <span class="string">&#x27;null&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;BAIDUID_BFESS&#x27;</span>: <span class="string">&#x27;08BC8B371D41816A13367C0125B857DA:FG=1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;BDRCVFR[-pGxjrCMryR]&#x27;</span>: <span class="string">&#x27;mk3SLVN4HKm&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;ab_sr&#x27;</span>: <span class="string">&#x27;1.0.1_ZjRkZDI3ZDU5MTczYTFkMTNkMTZjM2ZiZDMxMWZiZDI3Y2M3ZTVlNTZlMjBhNDVkOWE0YmIzMzY3MjA2ZDNkYmU2NDU3ODIyYjkwZmExNWE5ZmM3NzI4ZTk3ZWU5MTQ3MTM5NzVlMTRhNThjNjYzYWRmMTcyZDAxOGMwZjM2MGE1YjE0ZjRmNzhkNzYyNGY1YWZkNTUxNDg2YTBmZTYyOA==&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        self.n = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        key_word = <span class="built_in">input</span>(<span class="string">&quot;keyword:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> key_word:</span><br><span class="line">            key_word = <span class="string">&#x27;赵丽颖&#x27;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;tn&quot;</span>: <span class="string">&quot;baiduimage&quot;</span>,</span><br><span class="line">            <span class="string">&quot;word&quot;</span>: key_word,</span><br><span class="line">        &#125;</span><br><span class="line">        params = urllib.parse.urlencode(params)</span><br><span class="line">        url = <span class="string">f&quot;<span class="subst">&#123;self.url&#125;</span><span class="subst">&#123;params&#125;</span>&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        base_html = requests.get(url, headers=self.my_header, cookies=self.cookies)</span><br><span class="line">        re_pattern_0 = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;imgData&#x27;(.*?)&#x27;fcadData&#x27;&quot;</span>, re.S)</span><br><span class="line">        result_0 = re_pattern_0.search(base_html.text)</span><br><span class="line">        re_pattern_1 = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&quot;thumbURL&quot;:.*?&quot;(.*?)&quot;.*?&quot;replaceUrl&quot;&#x27;</span>, re.S)</span><br><span class="line">        thumb_url_list = re_pattern_1.findall(result_0.group())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> thumb_url <span class="keyword">in</span> thumb_url_list:</span><br><span class="line">            self.save_image(thumb_url, key_word)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_image</span>(<span class="params">self, url, key_word</span>):</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        resp = requests.get(url, headers=self.my_header, cookies=self.cookies)</span><br><span class="line">        filename = <span class="string">f&#x27;<span class="subst">&#123;key_word&#125;</span>_<span class="subst">&#123;self.n&#125;</span>.jpg&#x27;</span></span><br><span class="line">        directory_path = <span class="string">f&#x27;baidu_images/<span class="subst">&#123;key_word&#125;</span>/&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory_path):</span><br><span class="line">            os.makedirs(directory_path)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&quot;<span class="subst">&#123;directory_path&#125;</span><span class="subst">&#123;filename&#125;</span>&quot;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(resp.content)</span><br><span class="line">        self.n += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;filename&#125;</span> downloaded&quot;</span>)</span><br><span class="line">        time.sleep(random.randint(<span class="number">1</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    spider = BaiduImageSpider()</span><br><span class="line">    spider.run()</span><br></pre></td></tr></table></figure>

<h3 id="lxml-xpath"><a href="#lxml-xpath" class="headerlink" title="lxml   xpath"></a>lxml   xpath</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">title</span>&gt;</span>My page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Welcome to my page<span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;www.example.com&quot;</span>&gt;</span>page<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is the first paragraph<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>For getting the text inside the <code>&lt;p&gt;</code> tag,</p>
<p>XPath : <code>html/body/p/text()</code><br>Result : This is the first paragraph</p>
<p>For getting a value inside the <code>&lt;href&gt;</code> attribute in the anchor or <code>&lt;a&gt;</code> tag,</p>
<p>XPath : <code>html/body/a/@href</code><br>Result: <code>www.example.com</code></p>
<p>For getting the value inside the second <code>&lt;h2&gt;</code> tag,</p>
<p>XPath : <code>html/body/h2[2]/text()</code><br>Result: Hello World</p>
<p>注意<code>//h1/text()</code>结果是个数组</p>
<hr>
<ul>
<li>Specifying a complete path with <strong>&#x2F;</strong> as separator<br><code>title = root.xpath(&#39;/html/body/div/div/div[2]/h1&#39;)</code></li>
</ul>
<p>is the full path to my blog title. Notice how we request the 2nd element of the third set of div elements using <code>div[2]</code> – xpath arrays are one-based, not zero-based.</p>
<ul>
<li>Specifying a path with wildcards using <strong>&#x2F;&#x2F;</strong><br>This expression also finds the title but the preamble of &#x2F;html&#x2F;body&#x2F;div&#x2F;div is absorbed by the &#x2F;&#x2F; wildcard match:</li>
</ul>
<p><code>title = root.xpath(&#39;//div[2]/h1&#39;)</code></p>
<ul>
<li>Specifying an element by attribute<br>We can select elements which have particular attribute values:</li>
</ul>
<p><code>tagcloud = root.xpath(&#39;//*[@class=&quot;tagcloud&quot;]&#39;)</code></p>
<p>this selects the tag cloud on my blog by selecting elements which having the class attribute “tagcloud”.</p>
<ul>
<li>Select via a parent or sibling relationship<br>Sometimes we want to select elements by their relationship to another element, for example:</li>
</ul>
<p>subtitle &#x3D; root.xpath(‘&#x2F;&#x2F;h1[contains(@class,”header_title”)]&#x2F;..&#x2F;h2’)</p>
<p>this selects the h1 title of my blog (SomeBeans) then navigates to the parent with .. and selects the sibling h2 element (the subtitle “the makings of a small casserole”).</p>
<p>The same effect can be achieved with the following-sibling keyword:</p>
<p>subtitle &#x3D; root.xpath(‘&#x2F;&#x2F;h1[contains(@class,”header_title”)]&#x2F;following-sibling::h2’)</p>
<hr>
<p><img src="/assets/images/xiaoyuan_python/image-4.png" alt="Alt text"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">tree = etree.parse(<span class="string">&quot;data10.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/html/body/ul/li[1]/a/text()&quot;) # the first is &quot;1&quot;</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/html/body/ol/li/a[@href=&#x27;dapao&#x27;]/text()&quot;) # the first is &quot;1&quot;</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book/author//nick/text()&quot;)</span></span><br><span class="line"><span class="comment"># result = tree.xpath(&quot;/book/author/*/nick/text()&quot;)</span></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">result = tree.xpath(<span class="string">&quot;/html/body/ol/li&quot;</span>) <span class="comment"># </span></span><br><span class="line">the first <span class="keyword">is</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(li.xpath(<span class="string">&quot;./a/text()&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(li.xpath(<span class="string">&quot;./a/@href&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The fromstring() function<br>The fromstring() function is the easiest way to parse a string:</p>
<blockquote>
<blockquote>
<blockquote>
<p>some_xml_data &#x3D; “<root>data</root>“</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>root &#x3D; etree.fromstring(some_xml_data)<br>print(root.tag)<br>root<br>etree.tostring(root)<br>b’<root>data</root>‘</p>
</blockquote>
</blockquote>
</blockquote>
<p>The XML() function<br>The XML() function behaves like the fromstring() function, but is commonly used to write XML literals right into the source:</p>
<p>There is also a corresponding function HTML() for HTML literals.</p>
<p><code>root = etree.HTML(&quot;&lt;p&gt;data&lt;/p&gt;&quot;)</code></p>
<p>The parse() function<br>The parse() function is used to parse from files and file-like objects.</p>
<h4 id="example-1"><a href="#example-1" class="headerlink" title="example"></a>example</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">html = <span class="string">&#x27;&#x27;</span></span><br><span class="line">parse_html = etree.HTML(html)</span><br><span class="line">r_list = parse_html.xpath(<span class="string">&#x27;//[@class=&quot;name&quot;]/text()&#x27;</span>)</span><br><span class="line"><span class="comment"># div_list = parse_html.xpath(&#x27;//[@class=&quot;name_1&quot;]/div&#x27;)</span></span><br><span class="line"><span class="comment"># r_list = div_list.xpath(&#x27;.//[@class=&quot;name_2&quot;]/img/@src&#x27;)</span></span><br></pre></td></tr></table></figure>

<h4 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h4><p><code>//tagname</code><br>at nay level of parent element<br><code>//tagename[1]</code><br><code>//tagname[@attributeName=&quot;value&quot;]</code><br>contain()<br><code>//tagname[contains(@attributeName,&#39;value&#39;)]</code><br>starts-with()<br>and or<br><code>//tagname[(expression 1)and(expression 2)]</code></p>
<p>get text<br><code>//h1/text()</code></p>
<p><code>/</code><br>the children<br><code>//</code><br>all the children within any level<br><code>.</code><br>current<br><code>..</code><br>parent<br><code>*</code><br>any elements</p>
<h3 id="css-selector"><a href="#css-selector" class="headerlink" title="css selector"></a>css selector</h3><p><img src="/assets/images/xiaoyuan_python/image-6.png" alt="Alt text"></p>
<p>xpath: &#x2F;html&#x2F;body&#x2F;p<br>CSS selector: html &gt; body &gt; p</p>
<p>Basic CSS Selectors Cheatsheet</p>
<table>
<thead>
<tr>
<th>Selector</th>
<th>Description</th>
<th>Example</th>
<th>Explanation</th>
</tr>
</thead>
<tbody><tr>
<td>Tag Selector</td>
<td>Selects elements based on their tag name.</td>
<td>p</td>
<td>Selects all <code>&lt;p&gt;</code> elements.</td>
</tr>
<tr>
<td>Class Selector</td>
<td>Selects elements based on their class name.</td>
<td>.example</td>
<td>Selects all elements with the class name “example”.</td>
</tr>
<tr>
<td>ID Selector</td>
<td>Selects an element based on its ID.</td>
<td>#example</td>
<td>Selects the element with the ID “example”.</td>
</tr>
<tr>
<td>Attribute Selector</td>
<td>Selects elements based on their attribute and value.</td>
<td>[type&#x3D;”text”]</td>
<td>Selects all elements with the attribute “type” and</td>
</tr>
<tr>
<td>Descendant Selector</td>
<td>Selects elements that are descendants of another element.</td>
<td>div p</td>
<td>Selects all <code>&lt;p&gt;</code> elements that are descendants of a <code>&lt;div&gt;</code></td>
</tr>
<tr>
<td>Child Selector</td>
<td>Selects elements that are direct children of another element.</td>
<td>ul &gt; li</td>
<td>Selects all <code>&lt;li&gt;</code> elements that are direct children of a <code>&lt;ul&gt;</code> element.</td>
</tr>
<tr>
<td>Pseudo-Class Selector</td>
<td>Selects elements based on their state or position in the document.</td>
<td>a:hover</td>
<td>Selects all <code>&lt;a&gt;</code> elements when the mouse is</td>
</tr>
</tbody></table>
<p>There are many pseudo-class selectors, some of which are described in this table.</p>
<table>
<thead>
<tr>
<th>Pseudo-class Selector</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>:hover</td>
<td>Selects an element when the mouse pointer</td>
</tr>
<tr>
<td>:active</td>
<td>Selects an element when it is being</td>
</tr>
<tr>
<td>:visited</td>
<td>Selects a link that has been visited by</td>
</tr>
<tr>
<td>:focus</td>
<td>Selects an element when it has focus (e.g.</td>
</tr>
<tr>
<td>:first-child</td>
<td>Selects the first child element of its</td>
</tr>
<tr>
<td>:last-child</td>
<td>Selects the last child element of its</td>
</tr>
<tr>
<td>:nth-child(n)</td>
<td>Selects the nth child element of its</td>
</tr>
<tr>
<td>:nth-of-type(n)</td>
<td>Selects the nth element of its type</td>
</tr>
<tr>
<td>:last-of-type</td>
<td>Selects the last occurrence of an</td>
</tr>
</tbody></table>
<p>The CSS expression below shows how to select the first div of the body element.</p>
<p>html &gt; body &gt; div:nth-of-type(1)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>This one<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>not This one<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>not This one<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>The next-sibling combinator (+) separates two selectors and matches the second element only if it immediately follows the first element, and both are children of the same parent element.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>One<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Two!<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>Three<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>select the <code>&lt;li&gt;Two!&lt;/li&gt;</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">li</span><span class="selector-pseudo">:first</span>-of-type + <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>Select by attribute value containing<br><code>input[class*=&quot;example&quot;]</code></p>
<p>Select by attribute value starting with<br><code>input[id^=&quot;example&quot;]</code></p>
<p>Select by attribute value ending with<br><code>a[href$=&quot;example&quot;]</code></p>
<hr>
<p>XPath to CSS Selector Conversion</p>
<table>
<thead>
<tr>
<th>Equivalency</th>
<th>XPath Notation</th>
<th>CSS Selector</th>
</tr>
</thead>
<tbody><tr>
<td>Select by element type</td>
<td>&#x2F;&#x2F;div</td>
<td>div</td>
</tr>
<tr>
<td>Select by class name</td>
<td><code>//div[@class=”example”]</code></td>
<td>div.example</td>
</tr>
<tr>
<td>Select by ID</td>
<td><code>//*[@id=”example”]</code></td>
<td>#example</td>
</tr>
<tr>
<td>Select by attribute</td>
<td><code>//input[@name=”example”]</code></td>
<td><code>input[name=”example”]</code></td>
</tr>
<tr>
<td>Select by attribute value containing</td>
<td><code>//input[contains(@class, “example”)]</code></td>
<td><code>input[class*=”example”]</code></td>
</tr>
<tr>
<td>Select by attribute value starting with</td>
<td><code>//input[starts-with(@id, “example”)]</code></td>
<td><code>input[id^=”example”]</code></td>
</tr>
<tr>
<td>Select by attribute value ending with</td>
<td><code>//a[ends-with(@href, “example”)]</code></td>
<td><code>a[href$=”example”]</code></td>
</tr>
<tr>
<td>Select by sibling</td>
<td>&#x2F;&#x2F;div&#x2F;following-sibling::p</td>
<td>div + p</td>
</tr>
<tr>
<td>Select by descendant</td>
<td>&#x2F;&#x2F;div&#x2F;&#x2F;p</td>
<td>div p</td>
</tr>
<tr>
<td>Select by first child</td>
<td><code>//div/p[1]</code></td>
<td>div &gt;</td>
</tr>
<tr>
<td>Select by last child</td>
<td><code>//div/p[last()]</code></td>
<td>div &gt;</td>
</tr>
</tbody></table>
<h3 id="parsel-Selector"><a href="#parsel-Selector" class="headerlink" title="parsel.Selector"></a>parsel.Selector</h3><p><code>$ pip install parsel</code></p>
<p>.xpath() and .css() methods return a SelectorList instance, which is a list of new selectors.</p>
<p>If you want to extract only the first matched element, you can call the selector .get()</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> parsel <span class="keyword">import</span> Selector</span><br><span class="line">html_text = <span class="string">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello, Parsel!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span></span><br><span class="line">html_selector = Selector(text=html_text)</span><br><span class="line">html_selector.css(<span class="string">&#x27;h1&#x27;</span>)</span><br><span class="line"><span class="comment"># [&lt;Selector query=&#x27;descendant-or-self::h1&#x27; data=&#x27;&lt;h1&gt;Hello, Parsel!&lt;/h1&gt;&#x27;&gt;]</span></span><br><span class="line">html_selector.xpath(<span class="string">&#x27;//h1&#x27;</span>)  <span class="comment"># the same, but now with XPath</span></span><br><span class="line"><span class="comment"># [&lt;Selector query=&#x27;//h1&#x27; data=&#x27;&lt;h1&gt;Hello, Parsel!&lt;/h1&gt;&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<hr>
<p>selecting the text inside the title tag:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">selector.xpath(<span class="string">&#x27;//title/text()&#x27;</span>)</span><br><span class="line"><span class="comment"># [&lt;Selector query=&#x27;//title/text()&#x27; data=&#x27;Example website&#x27;&gt;]</span></span><br><span class="line"></span><br><span class="line">selector.css(<span class="string">&#x27;title::text&#x27;</span>)</span><br><span class="line"><span class="comment"># [&lt;Selector query=&#x27;descendant-or-self::title/text()&#x27; data=&#x27;Example website&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<p>To actually extract the textual data, you must call the selector .get() or .getall() methods, as follows:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">selector.xpath(<span class="string">&#x27;//title/text()&#x27;</span>).getall()</span><br><span class="line"><span class="comment"># [&#x27;Example website&#x27;]</span></span><br><span class="line">selector.xpath(<span class="string">&#x27;//title/text()&#x27;</span>).get()</span><br><span class="line"><span class="comment"># &#x27;Example website&#x27;</span></span><br></pre></td></tr></table></figure>

<p>query for attributes using .attrib property of a Selector:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[img.attrib[<span class="string">&#x27;src&#x27;</span>] <span class="keyword">for</span> img <span class="keyword">in</span> selector.css(<span class="string">&#x27;img&#x27;</span>)]</span><br><span class="line"><span class="comment"># [&#x27;image1_thumb.jpg&#x27;, &#x27;image2_thumb.jpg&#x27;, &#x27;image3_thumb.jpg&#x27;, &#x27;image4_thumb.jpg&#x27;, &#x27;image5_thumb.jpg&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>As a shortcut, .attrib is also available on SelectorList directly; it returns attributes for the first matching element:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">selector.css(<span class="string">&#x27;img&#x27;</span>).attrib[<span class="string">&#x27;src&#x27;</span>]</span><br><span class="line"><span class="comment"># &#x27;image1_thumb.jpg&#x27;</span></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> parsel <span class="keyword">import</span> Selector</span><br><span class="line">selector_1 = Selector(resp.text)</span><br><span class="line">text_1 = selector_1.css(<span class="string">&quot;//div[@class=&quot;</span>example<span class="string">&quot;]&quot;</span>).get()</span><br></pre></td></tr></table></figure>

<h3 id="bs4"><a href="#bs4" class="headerlink" title="bs4"></a>bs4</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">page = BeautifulSoup(content, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"><span class="comment"># div_item = page.find(&quot;div&quot;, class_=&quot;item&quot;)</span></span><br><span class="line">ol = page.find(<span class="string">&quot;ol&quot;</span>, attrs=&#123;<span class="string">&quot;class&quot;</span>: <span class="string">&quot;grid_view&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># print(div_item)</span></span><br><span class="line">lis = ol.find_all(<span class="string">&quot;li&quot;</span>)</span><br><span class="line"></span><br><span class="line">a = li.find(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">a.get(<span class="string">&quot;href&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">img = article.find_all(<span class="string">&quot;img&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    img_src = img.get(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">    img_resp = requests.get(img_src, headers=my_headers)</span><br><span class="line">    img_resp.close()</span><br><span class="line">    img_name = img_src.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&quot;data08/<span class="subst">&#123;img_name&#125;</span>&quot;</span>, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">        f1.write(img_resp.content)</span><br></pre></td></tr></table></figure>

<p><img src="/assets/images/xiaoyuan_python/image-3.png" alt="Alt text"></p>
<h4 id="bs4-lxml"><a href="#bs4-lxml" class="headerlink" title="bs4 lxml"></a>bs4 lxml</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">html = requests.get(<span class="string">&quot;https://www.google.com/search?q=minecraft&quot;</span>, headers=headers)</span><br><span class="line">soup = BeautifulSoup(html.text, <span class="string">&quot;lxml&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> soup.select(<span class="string">&quot;.tF2Cxc&quot;</span>):</span><br><span class="line">    title = result.select_one(<span class="string">&quot;.DKV0Md&quot;</span>).text</span><br><span class="line">    link = result.select_one(<span class="string">&quot;.yuRUbf a&quot;</span>)[<span class="string">&quot;href&quot;</span>]</span><br><span class="line">    displayed_link = result.select_one(<span class="string">&quot;.lEBKkf span&quot;</span>).text</span><br><span class="line">    snippet = result.select_one(<span class="string">&quot;.lEBKkf span&quot;</span>).text</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;title&#125;</span>\n<span class="subst">&#123;link&#125;</span>\n<span class="subst">&#123;displayed_link&#125;</span>\n<span class="subst">&#123;snippet&#125;</span>\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="bs4-1"><a href="#bs4-1" class="headerlink" title="bs4"></a>bs4</h3><p><img src="/assets/images/it_sisu_web_scraping/image.png" alt="Alt text"></p>
<h4 id="获取信息："><a href="#获取信息：" class="headerlink" title="获取信息："></a>获取信息：</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;baidu&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body link=&quot;#0000cc&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div id=&quot;wrapper&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div id=&quot;head&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;head_wrapper&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div id=&quot;u1&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;http://news.baidu.com&quot; class=&quot;mnav&quot; name=&quot;tj_trnews&quot;&gt;&lt;!--news--&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;http://news.baidu.com&quot; class=&quot;mnav&quot; name=&quot;tj_trnews&quot;&gt;news&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;https://www.hao123.com&quot; class=&quot;mnav&quot; name=&quot;tj_trhao123&quot;&gt;hao123&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;http://map.baidu.com&quot; class=&quot;mnav&quot; name=&quot;tj_trmap&quot;&gt;map&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;http://v.baidu.com&quot; class=&quot;mnav&quot; name=&quot;tj_trvideo&quot;&gt;video&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;http://tieba.baidu.com&quot; class=&quot;mnav&quot; name=&quot;tj_trtieba&quot;&gt;tieba&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;http://www.baidu.com/more/&quot; class=&quot;bri&quot; name=&quot;tj_briicon&quot; style=&quot;&quot;&gt;more&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">bs = BeautifulSoup(html, <span class="string">&quot;lxml&quot;</span>)</span><br><span class="line">first_a_link = bs.find(name=<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(first_a_link)</span><br><span class="line"><span class="comment"># &lt;a class=&quot;mnav&quot; href=&quot;http://news.baidu.com&quot; name=&quot;tj_trnews&quot;&gt;&lt;!--news--&gt;&lt;/a&gt;</span></span><br></pre></td></tr></table></figure>


<p>节点名称<br><code>print(first_a_link.name)   # &quot;a&quot;</code></p>
<p>节点属性</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(first_a_link.attrs)  <span class="comment"># dictinary : &#123;&#x27;href&#x27;: &#x27;http://news.baidu.com&#x27;, &#x27;class&#x27;: [&#x27;mnav&#x27;], &#x27;name&#x27;: &#x27;tj_trnews&#x27;&#125;</span></span><br><span class="line"><span class="built_in">print</span>(first_a_link.attrs[<span class="string">&quot;href&quot;</span>]) <span class="comment"># http://news.baidu.com</span></span><br></pre></td></tr></table></figure>

<p>节点文本内容<br><code>print(first_a_link.string)  # &quot;news&quot;</code></p>
<p>嵌套选择节点</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">first_div_element = bs.find(name=<span class="string">&quot;div&quot;</span>)</span><br><span class="line">a_in_div = first_div_element.find(name=<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a_in_div) <span class="comment">#&lt;a class=&quot;mnav&quot; href=&quot;http://news.baidu.com&quot; name=&quot;tj_trnews&quot;&gt;&lt;!--news--&gt;&lt;/a&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="find-findall"><a href="#find-findall" class="headerlink" title="find findall"></a>find findall</h4><p>findall(name&#x3D;””, attrs&#x3D;{}, text&#x3D;””)</p>
<p>name节点名称<br>attrs节点属性</p>
<p>常用属性id class 直接传入</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(bs.find(<span class="built_in">id</span>=<span class="string">&quot;head&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(bs.find(class_=<span class="string">&quot;mnav&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>text节点文本内容</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a_link = bs.find_all(<span class="string">&quot;a&quot;</span>, attrs=&#123;<span class="string">&quot;href&quot;</span>: <span class="string">&quot;http://news.baidu.com&quot;</span>&#125;)</span><br><span class="line"><span class="comment"># [&lt;a class=&quot;mnav&quot; href=&quot;http://news.baidu.com&quot; name=&quot;tj_trnews&quot;&gt;&lt;!--news--&gt;&lt;/a&gt;,</span></span><br><span class="line"><span class="comment"># &lt;a class=&quot;mnav&quot; href=&quot;http://news.baidu.com&quot; name=&quot;tj_trnews&quot;&gt;news&lt;/a&gt;]</span></span><br><span class="line"><span class="built_in">print</span>(a_link)   <span class="comment"># list</span></span><br></pre></td></tr></table></figure>

<h3 id="beautifulsoup"><a href="#beautifulsoup" class="headerlink" title="beautifulsoup"></a>beautifulsoup</h3><p>install packages:</p>
<p>requests<br>beautifulsoup4<br>lxml</p>
<h3 id="bs4-2"><a href="#bs4-2" class="headerlink" title="bs4"></a>bs4</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;www.google.com&#x27;</span></span><br><span class="line"></span><br><span class="line">result = requests.get(url)</span><br><span class="line"></span><br><span class="line">content = result.text</span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(content, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># soup.find(&#x27;tagname&#x27;, class_=&#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># soup.find(&#x27;tagname&#x27;, id=&#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># soup.find(&#x27;tagname&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># soup.find_all(&#x27;h2&#x27;)</span></span><br></pre></td></tr></table></figure>

<p><code>subscript = soup.find(&#39;div&#39;, class_=&#39;full-script&#39;).get_text(separator=&quot;\n&quot;, strip=True)</code></p>
<p>def get_text(self,<br>             separator: str &#x3D; “”,<br>             strip: bool &#x3D; False,<br>             types: tuple[Type[NavigableString], …] &#x3D; …) -&gt; str<br>Get all child strings of this PageElement, concatenated using the given separator.<br>Params:<br>separator – Strings will be concatenated using this separator.<br>strip – If True, strings will be stripped before being concatenated.<br>types – A tuple of NavigableString subclasses. Any strings of a subclass not found in this list will be ignored. Although there are exceptions, the default behavior in most cases is to consider only NavigableString and CData objects. That means no comments, processing instructions, etc.<br>Returns:<br>A string.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">movie_urls = movie_list.find_all(<span class="string">&#x27;a&#x27;</span>, href=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">links = []</span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> movie_urls:</span><br><span class="line">    links.append(link[<span class="string">&#x27;href&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h4 id="subslikescript-com"><a href="#subslikescript-com" class="headerlink" title="subslikescript.com"></a>subslikescript.com</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">root = <span class="string">&#x27;https://subslikescript.com&#x27;</span></span><br><span class="line"><span class="comment"># website = &#x27;https://subslikescript.com/movies?page=2&#x27;</span></span><br><span class="line">website = <span class="string">f&#x27;<span class="subst">&#123;root&#125;</span>/movies&#x27;</span></span><br><span class="line"><span class="comment"># website = &#x27;https://subslikescript.com/movie/Titanic-120338&#x27;</span></span><br><span class="line"></span><br><span class="line">result = requests.get(website, timeout=<span class="number">5</span>, verify=<span class="literal">False</span>)</span><br><span class="line">content = result.text</span><br><span class="line">soup = BeautifulSoup(content, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"><span class="comment"># print(soup.prettify())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pagination</span></span><br><span class="line">nav = soup.find(<span class="string">&#x27;ul&#x27;</span>, class_=<span class="string">&#x27;pagination&#x27;</span>)</span><br><span class="line">pages = nav.find_all(<span class="string">&#x27;li&#x27;</span>, class_=<span class="string">&#x27;page-item&#x27;</span>)[-<span class="number">2</span>].get_text(strip=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(pages)</span><br><span class="line">pages = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">links = []</span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">int</span>(pages) + <span class="number">1</span>):</span><br><span class="line">    website = <span class="string">f&#x27;<span class="subst">&#123;root&#125;</span>/movies?page=<span class="subst">&#123;page&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">    result = requests.get(website, timeout=<span class="number">5</span>, verify=<span class="literal">False</span>)</span><br><span class="line">    content = result.text</span><br><span class="line">    soup = BeautifulSoup(content, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(soup.prettify())</span></span><br><span class="line"></span><br><span class="line">    movie_list = soup.find(<span class="string">&#x27;ul&#x27;</span>, class_=<span class="string">&#x27;scripts-list&#x27;</span>)</span><br><span class="line">    movie_urls = movie_list.find_all(<span class="string">&#x27;a&#x27;</span>, href=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> link <span class="keyword">in</span> movie_urls:</span><br><span class="line">        links.append(link[<span class="string">&#x27;href&#x27;</span>])</span><br><span class="line">    <span class="comment"># print(links)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        website = <span class="string">f&quot;<span class="subst">&#123;root&#125;</span>/<span class="subst">&#123;link&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        result = requests.get(website, timeout=<span class="number">10</span>, verify=<span class="literal">False</span>)</span><br><span class="line">        content = result.text</span><br><span class="line">        soup = BeautifulSoup(content, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        article = soup.find(<span class="string">&#x27;article&#x27;</span>, class_=<span class="string">&#x27;main-article&#x27;</span>)</span><br><span class="line">        title = article.find(<span class="string">&#x27;h1&#x27;</span>).get_text()</span><br><span class="line">        <span class="built_in">print</span>(title)</span><br><span class="line">        subscript = article.find(<span class="string">&#x27;div&#x27;</span>, class_=<span class="string">&#x27;full-script&#x27;</span>).get_text(separator=<span class="string">&quot;\n&quot;</span>, strip=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># print(subscript)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;subslikescript_com/<span class="subst">&#123;title&#125;</span>.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            file.write(subscript)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h3 id="css-select"><a href="#css-select" class="headerlink" title="css select"></a>css select</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(bs.select(<span class="string">&quot;div&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(bs.select(<span class="string">&quot;div#head&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(bs.select(<span class="string">&quot;a.mnav&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(bs.select(<span class="string">&#x27;a[class=&quot;mnav&quot;]&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(bs.select(<span class="string">&#x27;div a&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas</span><br><span class="line">film_names = [<span class="string">&quot;无间道&quot;</span>, <span class="string">&quot;霸王别姬&quot;</span>, <span class="string">&quot;楚门的世界&quot;</span>]</span><br><span class="line">film_scores = [<span class="string">&quot;9.38&quot;</span>, <span class="string">&quot;9.0&quot;</span>, <span class="string">&quot;9.1&quot;</span>]</span><br><span class="line">df = pandas.DataFrame()</span><br><span class="line">df[<span class="string">&quot;电影名称&quot;</span>] = film_names</span><br><span class="line">df[<span class="string">&quot;评分&quot;</span>] = film_scores</span><br><span class="line"></span><br><span class="line">df.to_excel(<span class="string">&quot;films.xlsx&quot;</span>, index = <span class="literal">False</span>)  <span class="comment"># index = False 去掉索引列</span></span><br></pre></td></tr></table></figure>

<h2 id="json"><a href="#json" class="headerlink" title="json"></a>json</h2><p>json_string &#x3D; resp.text().decode() # 是 json格式字符串</p>
<p>json_dict &#x3D; json.loads(json_string, encoding&#x3D;’utf-8’)</p>
<p>json dict -&gt; json string<br>json.dumps()</p>
<h3 id="example-2"><a href="#example-2" class="headerlink" title="example"></a>example</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">response = requests.post(url, data=data, headers=headers)</span><br><span class="line"></span><br><span class="line">json_dict = response.json()</span><br><span class="line"><span class="comment"># json_list = response.json()</span></span><br><span class="line"></span><br><span class="line">fp = <span class="built_in">open</span>(<span class="string">&#x27;./dog.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">json.dump(json_dict, fp=fp, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># json.dump(json_list, fp=fp, ensure_ascii=False)</span></span><br><span class="line">fp.close()</span><br></pre></td></tr></table></figure>

<h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://passport.17k.com/ck/user/login&quot;</span></span><br><span class="line">session = requests.session()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;loginName&quot;</span>: <span class="string">&quot;some username&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;some password&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">login_resp = session.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(login_resp.cookies)</span><br><span class="line"></span><br><span class="line">shelf_resp = session.get(<span class="string">&quot;https://user.17k.com/ck/author2/shelf?page=1&amp;appKey=2406394919&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(shelf_resp.json())</span><br><span class="line"></span><br><span class="line">login_resp.close()</span><br><span class="line">shelf_resp.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_header = &#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;some cookie from web browser&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">shelf_d_resp = requests.get(<span class="string">&quot;https://user.17k.com/ck/author2/shelf?page=1&amp;appKey=2406394919&quot;</span>, headers=my_header)</span><br><span class="line"><span class="built_in">print</span>(shelf_d_resp.json())</span><br><span class="line">shelf_d_resp.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="referer"><a href="#referer" class="headerlink" title="referer"></a>referer</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: url,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="pycrypto-安装"><a href="#pycrypto-安装" class="headerlink" title="pycrypto 安装"></a>pycrypto 安装</h2><p>The Visual C++ Redistributable installs Microsoft C and C++ (MSVC) runtime libraries. These libraries are required by many applications built by using Microsoft C and C++ tools. If your app uses those libraries, a Microsoft Visual C++ Redistributable package must be installed on the target system before you install your app.</p>
<p>Microsoft C++ 生成工具通过可编写脚本的独立安装程序提供 MSVC 工具集，无需使用 Visual Studio。 如果从命令行界面（例如，持续集成工作流中）生成面向 Windows 的 C++ 库和应用程序， 则推荐使用此工具。</p>
<p>Win7安装pycrypto报错ucrt\inttypes.h(26): error C2061: syntax error: identifier ‘intmax_t‘<br>1.将C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\include下的stdint.h复制到C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt2.编辑C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt下的inttypes.h将#include &lt;stdint.h&gt;改为#include “stdint.h”, 目的是让它使用上面第一点复制的头文件stdint.h</p>
<p>pycrypto is no longer maintained: see pycrypto.org <strong>pycryptodome</strong> is the modern maintained replacement for pycrypto</p>
<h2 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h2><p>m3u8</p>
<p><img src="/assets/images/xiaoyuan_python/image-5.png" alt="Alt text"></p>
<p>https%3A%2F%2Fnew.1080pzy.co%2F20230116%2F34sxZOJQ%2Findex.m3u8</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://new.1080pzy.co/20230116/34sxZOJQ/index.m3u8</span><br><span class="line">#EXTM3U</span><br><span class="line">#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=1100000,RESOLUTION=960x540</span><br><span class="line">/20230116/34sxZOJQ/1100kb/hls/index.m3u8</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">https://new.1080pzy.co/20230116/34sxZOJQ/1100kb/hls/index.m3u8</span><br><span class="line">#EXTM3U</span><br><span class="line">#EXT-X-VERSION:3</span><br><span class="line">#EXT-X-TARGETDURATION:4</span><br><span class="line">#EXT-X-PLAYLIST-TYPE:VOD</span><br><span class="line">#EXT-X-MEDIA-SEQUENCE:0</span><br><span class="line">#EXTINF:3.086,</span><br><span class="line">https://hey05.cjkypo.com/20230116/34sxZOJQ/1100kb/hls/c16ZdUp5.ts</span><br><span class="line">#EXTINF:2.085,</span><br><span class="line">https://hey05.cjkypo.com/20230116/34sxZOJQ/1100kb/hls/zAiBKR1T.ts</span><br><span class="line">#EXTINF:2.085,</span><br><span class="line">https://hey05.cjkypo.com/20230116/34sxZOJQ/1100kb/hls/na7WHAiK.ts</span><br></pre></td></tr></table></figure>

<p>The data is UTF-8 encoded bytes escaped with URL quoting, so you want to decode, with urllib.parse.unquote(), which handles decoding from percent-encoded data to UTF-8 bytes and then to text, transparently:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from urllib.parse import unquote</span><br><span class="line">&gt;&gt;&gt; url = <span class="string">&#x27;example.com?title=%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D0%B2%D0%B0%D1%8F+%D0%B7%D0%B0%D1%89%D0%B8%D1%82%D0%B0&#x27;</span></span><br><span class="line">&gt;&gt;&gt; unquote(url)</span><br><span class="line"><span class="string">&#x27;example.com?title=правовая+защита&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ffmpeg使用语法:</p>
<p>具体一点来说：</p>
<ol>
<li><p>-f concat，-f 一般设置输出文件的格式，如-f psp（输出psp专用格式），但是如果跟concat，则表示采用concat协议，对文件进行连接合并。</p>
</li>
<li><p>-safe 0，用于忽略一些文件名错误，如长路径、空格、非ANSIC字符</p>
</li>
<li><p>-i D:\ProgramData\study\mov\order.m3u8，-i后面加输入文件名，当然也可以加输入文件名组成的文件名，即order.m3u8，但是要满足文件格式，即类似于下面这种:</p>
<p>file ‘D:\ProgramData\study\mov\tsfiles\MQJ9iKoM.ts’<br>file ‘D:\ProgramData\study\mov\tsfiles\8LeDe7Wu.ts’</p>
</li>
<li><p>-c copy D:\ProgramData\study\mov\hello.mp4，-c表示输出文件采用的编码器，后面跟copy，表示直接复制，不重新编码。</p>
</li>
</ol>
<h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;func&quot;</span>, i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    thread_1 = Thread(target=func)</span><br><span class="line">    thread_1.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;main&quot;</span>, i)</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;child thread&quot;</span>, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    thread_1 = MyThread()</span><br><span class="line">    thread_1.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;main&quot;</span>, i)</span><br></pre></td></tr></table></figure>

<h3 id="池"><a href="#池" class="headerlink" title="池"></a>池</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fn</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        <span class="built_in">print</span>(name, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor(<span class="number">8</span>) <span class="keyword">as</span> t_pool:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">            t_pool.submit(fn, name=<span class="string">f&quot;thread<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 等待进程池中的任务全部完成是才向下执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;finished!&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="协程coroutine"><a href="#协程coroutine" class="headerlink" title="协程coroutine"></a>协程coroutine</h3><p>阻塞<br><code>requests.get(url)</code><br>网络请求返回数据之前，处于阻塞状态。</p>
<p>协程：<br>当程序遇见IO操作时，选择性的切换到其他任务<br>微观上，单线程下，一个任务一个任务的进行切换，切换条件即IO操作<br>宏观上，多个任务同时执行，即多任务异步操作。</p>
<p>DeprecationWarning: The explicit passing of coroutine objects to asyncio.wait() is deprecated since Python 3.8, and scheduled for removal in Python 3.11.</p>
<p>The asyncio.wait() documentation obviously says nothing about this or what you’re supposed to do instead, but as far as I can figure out you replace asyncio.wait([a, b]) with asyncio.gather(a, b).</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world 1&quot;</span>)</span><br><span class="line">    <span class="comment"># time.sleep(4)</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">4</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world 1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world 2&quot;</span>)</span><br><span class="line">    <span class="comment"># time.sleep(3)</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world 2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func3</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world 3&quot;</span>)</span><br><span class="line">    <span class="comment"># time.sleep(2)</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world 3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># # Schedule three calls *concurrently*:</span></span><br><span class="line">    <span class="comment"># L = await asyncio.gather(</span></span><br><span class="line">    <span class="comment">#     func1(),</span></span><br><span class="line">    <span class="comment">#     func2(),</span></span><br><span class="line">    <span class="comment">#     func3(),</span></span><br><span class="line">    <span class="comment"># )</span></span><br><span class="line">    <span class="comment"># print(L)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> asyncio.wait([</span><br><span class="line">        asyncio.create_task(func1()),</span><br><span class="line">        asyncio.create_task(func2()),</span><br><span class="line">        asyncio.create_task(func3()),</span><br><span class="line">    ])</span><br><span class="line">t1 = time.time()</span><br><span class="line">asyncio.run(main())</span><br><span class="line">t2 = time.time()</span><br><span class="line"><span class="built_in">print</span>(t2 - t1)</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&quot;https://p.qqan.com/up/2023-9/16951819146781660.jpg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://p.qqan.com/up/2023-9/16950082886215315.jpg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://p.qqan.com/up/2023-9/16957095513204923.jpg&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">aio_download</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="comment"># &quot;sdfa&quot;.rsplit()</span></span><br><span class="line">    name = url.rsplit(<span class="string">&quot;/&quot;</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> resp:</span><br><span class="line">            <span class="comment"># resp.text()</span></span><br><span class="line">            <span class="comment"># resp.json()</span></span><br><span class="line">            <span class="comment"># await resp.content.read()</span></span><br><span class="line">            <span class="comment">## aiofiles 异步读写文件</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&quot;data21/<span class="subst">&#123;name&#125;</span>&quot;</span>, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="keyword">await</span> resp.content.read())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    tasks = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        task = asyncio.create_task(aio_download(url))</span><br><span class="line">        tasks.append(task)</span><br><span class="line">    <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h3 id="aes-解密-TS"><a href="#aes-解密-TS" class="headerlink" title="aes 解密 TS"></a>aes 解密 TS</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">dec_ts</span>(<span class="params">name, key</span>):</span><br><span class="line">    aes =AES.new(key=key, IV=<span class="string">b&#x27;0000000000000000&#x27;</span>, mode=AES.MODE_CBC)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiofiles.<span class="built_in">open</span>(<span class="string">f&quot;data23/<span class="subst">&#123;name&#125;</span>&quot;</span>, mode=<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f1,\</span><br><span class="line">        aiofiles.<span class="built_in">open</span>(<span class="string">f&quot;data23/temp_<span class="subst">&#123;name&#125;</span>&quot;</span>, mode= <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f2:</span><br><span class="line">        bs = <span class="keyword">await</span> f1.read()</span><br><span class="line">        <span class="keyword">await</span> f2.write(aes.decrypt(bs))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> decrypt finished&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ts合并"><a href="#ts合并" class="headerlink" title="ts合并"></a>ts合并</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mac os</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_ts</span>():</span><br><span class="line">    file_list = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data15/temp2.m3u8&quot;</span>, mode=<span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f :</span><br><span class="line">            <span class="keyword">if</span> line.startswith(<span class="string">&quot;#&quot;</span>):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            line = line.strip()</span><br><span class="line">            name = line.rsplit(<span class="string">&quot;/&quot;</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">            file_list.append(<span class="string">f&quot;data23/temp_<span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">    s = <span class="string">&quot; &quot;</span>.join(file_list)</span><br><span class="line">    os.system(<span class="string">f&quot;cat <span class="subst">&#123;s&#125;</span> &gt; movie.mp4&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># windows os</span></span><br><span class="line"><span class="comment">#文件夹下的ts文件的命名必须按照字母顺序排列, 否则合并文件后视频片段会产生混乱.（注意：名为‘10.ts’的文件的顺序会排在名为&#x27;9.ts&#x27;文件的前面，</span></span><br><span class="line"><span class="comment"># 也就是说，这里的字母顺序是指字符串的顺序。如果要用字符数字来命名ts文件，那么就需要给某些数字加上前导0）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_ts2</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;copy /b &#x27;</span> + <span class="string">r&#x27;C:\Users\lcf\Documents\learning\xiaoyuan\data23\*.ts &#x27;</span> + <span class="string">r&#x27;C:\Users\lcf\Documents\learning\xiaoyuan\data23\new.ts&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;合并成功&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="selenium"><a href="#selenium" class="headerlink" title="selenium"></a>selenium</h2><p>pip install selenium</p>
<p>install chrome driver<br>copy to the python.exe and scripts folder</p>
<p>if you have selenium above the 4.6.0 you don’t need to add executable_url and in the latest version of Selenium you don’t need to download webdriver.<br>With latest selenium(v4.6.0 and onwards), its in-built tool known as SeleniumManger can download and handle the driver.exe if you do not specify.</p>
<p>Selenium Manager provides automated driver management for: Google Chrome, Mozilla Firefox, Microsoft Edge.<br>Selenium Manager is invoked transparently by the Selenium bindings when:<br>No browser driver is detected on the PATH<br>No third party driver manager is being used</p>
<hr>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome, ChromeOptions</span><br><span class="line">chrome_options = ChromeOptions()</span><br><span class="line">chrome_options.add_experimental_option(<span class="string">&quot;detach&quot;</span>, <span class="literal">True</span>)</span><br><span class="line">web_browser = Chrome(options=chrome_options)</span><br><span class="line">web_browser.get(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(web_browser.title)</span><br></pre></td></tr></table></figure>

<p>With <code>WebDriverWait</code>, you don’t really have to take that into account. It will wait only as long as necessary until the desired element shows up (or it hits a timeout).</p>
<hr>
<p>A WebElement is a Selenium object representing an HTML element.</p>
<p>There are many actions that you can perform on those objects, here are the most useful:</p>
<p>Accessing the text of the element with the property <code>element.text</code><br>Clicking the element with <code>element.click()</code><br>Accessing an attribute with <code>element.get_attribute(&#39;class&#39;)</code><br>Sending text to an input with <code>element.send_keys(&#39;mypassword&#39;)</code></p>
<hr>
<p>WebDriver provides two main methods for finding elements.</p>
<p>find_element<br>find_elements</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>DOM Sample</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td>By.ID</td>
<td>Searches for elements based on their HTML ID</td>
<td><code>&lt;div id=&quot;myID&quot;&gt;</code></td>
<td>find_element(By.ID, “myID”)</td>
</tr>
<tr>
<td>By.NAME</td>
<td>Searches for elements based on their name attribute</td>
<td><code>&lt;input name=&quot;myNAME&quot;&gt;</code></td>
<td>find_element(By.NAME, “myNAME”)</td>
</tr>
<tr>
<td>By.XPATH</td>
<td>Searches for elements based on an XPath expression</td>
<td><code>&lt;span&gt;My &lt;a&gt;Link&lt;/a&gt;&lt;/span&gt;</code></td>
<td>find_element(By.XPATH, “&#x2F;&#x2F;span&#x2F;</td>
</tr>
<tr>
<td>By.LINK_TEXT</td>
<td>Searches for anchor elements based on a match of their text content</td>
<td><code>&lt;a&gt;My Link&lt;/a&gt;</code></td>
<td>find_element(By.LINK_TEXT, “My Link”)</td>
</tr>
<tr>
<td>By.PARTIAL_LINK_TEXT</td>
<td>Searches for anchor elements based on a sub-string match of their text content</td>
<td><code>&lt;a&gt;My Link&lt;/a&gt;</code></td>
<td>find_element(By.PARTIAL_LINK_TEXT, “Link”)</td>
</tr>
<tr>
<td>By.TAG_NAME</td>
<td>Searches for elements based on their tag name</td>
<td><code>&lt;h1&gt;</code></td>
<td>find_element(By.TAG_NAME, “h1”)</td>
</tr>
<tr>
<td>By.CLASS_NAME</td>
<td>Searches for elements based on their HTML classes</td>
<td><code>&lt;div class=&quot;myCLASS&quot;&gt;</code></td>
<td>find_element(By.CLASSNAME,</td>
</tr>
<tr>
<td>By.CSS_SELECTOR</td>
<td>Searches for elements based on a CSS selector</td>
<td><code>&lt;span&gt;My &lt;a&gt;Link&lt;/a&gt;&lt;/span&gt;</code></td>
<td>find_element(By.CSS_SELECTOR,</td>
</tr>
</tbody></table>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from selenium.webdriver import Chrome, ChromeOptions</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Chrome</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"></span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_experimental_option(<span class="string">&quot;detach&quot;</span>, <span class="literal">True</span>)</span><br><span class="line">web_browser = Chrome(options=chrome_options)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.lagou.com/&quot;</span></span><br><span class="line">web_browser.get(url)</span><br><span class="line"><span class="comment"># print(web_browser.title)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在selenium环境下可以大胆chrome复制XPATH</span></span><br><span class="line">location = web_browser.find_element(by=By.XPATH, value=<span class="string">&#x27;//*[@id=&quot;changeCityBox&quot;]/p[1]/a&#x27;</span>)</span><br><span class="line">location.click()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">search_input = web_browser.find_element(by=By.XPATH, value=<span class="string">&#x27;//*[@id=&quot;search_input&quot;]&#x27;</span>)</span><br><span class="line">search_input.send_keys(<span class="string">&quot;python&quot;</span>, Keys.ENTER)</span><br><span class="line"></span><br><span class="line"><span class="comment">## selenium 动态执行JS</span></span><br><span class="line">web_browser.execute_script(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">let a = document.getElementsByClassName(&quot;un-login-banner&quot;)[0];</span></span><br><span class="line"><span class="string">if (a) &#123;</span></span><br><span class="line"><span class="string">a.style.display = &quot;none&quot;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment">#    //*[@id=&quot;jobList&quot;]/div[1]/div[1]/div[1]/div[2]/div[1]/a</span></span><br><span class="line">jobs = web_browser.find_elements(by=By.XPATH, value=<span class="string">&#x27;//*[@id=&quot;jobList&quot;]/div[1]/div&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> job <span class="keyword">in</span> jobs:</span><br><span class="line">    job_name = job.find_element(By.XPATH, <span class="string">&#x27;.//*[@id=&quot;openWinPostion&quot;]&#x27;</span>)</span><br><span class="line">    <span class="comment"># company_name = job.find_element(By.XPATH, &#x27;./div[1]/div[2]/div[1]/a&#x27;)</span></span><br><span class="line">    <span class="comment"># print(job_name.text, company_name.text)</span></span><br><span class="line">    job_name.click()</span><br><span class="line">    <span class="comment">##切换 TAB</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    web_browser.switch_to.window(web_browser.window_handles[-<span class="number">1</span>])</span><br><span class="line">    job_detail = web_browser.find_element(By.XPATH,<span class="string">&#x27;//*[@id=&quot;job_detail&quot;]/dd[2]/div&#x27;</span>).text</span><br><span class="line">    <span class="built_in">print</span>(job_detail)</span><br><span class="line">    <span class="comment">## close tab</span></span><br><span class="line">    web_browser.close()</span><br><span class="line">    web_browser.switch_to.window(web_browser.window_handles[<span class="number">0</span>])</span><br><span class="line">    <span class="comment"># break</span></span><br><span class="line"><span class="comment"># web_browser.quit()</span></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">browser = Chrome()</span><br><span class="line">browser.get(<span class="string">&quot;&quot;</span>)</span><br><span class="line">html_source = browser.page_source</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdirver <span class="keyword">import</span> ChromeOptions</span><br><span class="line"></span><br><span class="line">option = ChromeOptions</span><br><span class="line"></span><br><span class="line">option.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line">dirver = Chrome(options=option)</span><br></pre></td></tr></table></figure>

<h2 id="selenium-1"><a href="#selenium-1" class="headerlink" title="selenium"></a>selenium</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> Select</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">website = <span class="string">&#x27;https://www.adamchoi.co.uk/overs/detailed&#x27;</span></span><br><span class="line">country = <span class="string">&#x27;Spain&#x27;</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(website)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">all_matches_button = driver.find_element(by=By.XPATH, value=<span class="string">&quot;//label[@analytics-event=&#x27;All matches&#x27;]&quot;</span>)</span><br><span class="line">all_matches_button.click()</span><br><span class="line"></span><br><span class="line">dropdown = Select(driver.find_element(by=By.ID, value=<span class="string">&#x27;country&#x27;</span>))</span><br><span class="line">dropdown.select_by_visible_text(country)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">matches = driver.find_elements(by=By.TAG_NAME, value=<span class="string">&#x27;tr&#x27;</span>)</span><br><span class="line"></span><br><span class="line">dates = []</span><br><span class="line">home_team = []</span><br><span class="line">score = []</span><br><span class="line">away_team = []</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">    <span class="comment"># print(match.text)</span></span><br><span class="line">    date = <span class="keyword">match</span>.find_element(by=By.XPATH, value=<span class="string">&#x27;./td[1]&#x27;</span>).text</span><br><span class="line">    <span class="built_in">print</span>(date)</span><br><span class="line">    dates.append(date)</span><br><span class="line">    home_team.append(<span class="keyword">match</span>.find_element(by=By.XPATH, value=<span class="string">&#x27;./td[2]&#x27;</span>).text)</span><br><span class="line">    score.append(<span class="keyword">match</span>.find_element(by=By.XPATH, value=<span class="string">&#x27;./td[3]&#x27;</span>).text)</span><br><span class="line">    away_team.append(<span class="keyword">match</span>.find_element(by=By.XPATH, value=<span class="string">&#x27;./td[4]&#x27;</span>).text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;date&#x27;</span>: dates,</span><br><span class="line">    <span class="string">&#x27;home_team&#x27;</span>: home_team,</span><br><span class="line">    <span class="string">&#x27;score&#x27;</span>: score,</span><br><span class="line">    <span class="string">&#x27;away_team&#x27;</span>: away_team,</span><br><span class="line">&#125;)</span><br><span class="line">df.to_csv(<span class="string">f&quot;www_adamchoi_co_uk/<span class="subst">&#123;country&#125;</span>_footbal_data.csv&quot;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="headless-mode"><a href="#headless-mode" class="headerlink" title="headless mode"></a>headless mode</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">options = Options()</span><br><span class="line">options.add_argument(<span class="string">&#x27;--headless=new&#x27;</span>)</span><br><span class="line">driver = webdriver.Chrome(CHROMEDRIVER_PATH, options=options)</span><br></pre></td></tr></table></figure>

<h3 id="audible-com"><a href="#audible-com" class="headerlink" title="audible.com"></a>audible.com</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions</span><br><span class="line"></span><br><span class="line"><span class="comment"># from selenium.webdriver.chrome.options import Options</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas</span><br><span class="line"></span><br><span class="line"><span class="comment"># website = &#x27;https://www.audible.com/search&#x27;</span></span><br><span class="line">website = <span class="string">&#x27;https://www.audible.com/adblbestsellers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># options = Options()</span></span><br><span class="line"><span class="comment"># options.add_argument(&#x27;--headless=new&#x27;)</span></span><br><span class="line"><span class="comment"># options.add_argument(&#x27;window-size=1920x1080&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome(options=options)</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(website)</span><br><span class="line">driver.maximize_window()</span><br><span class="line"></span><br><span class="line"><span class="comment"># time.sleep(5)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pagination</span></span><br><span class="line"></span><br><span class="line">pagination_li_s = (WebDriverWait(driver,<span class="number">10</span>)</span><br><span class="line">             .until(expected_conditions.presence_of_all_elements_located(</span><br><span class="line">    (By.XPATH, <span class="string">&#x27;//ul[contains(@class,&quot;pagingElements&quot;)]/li&#x27;</span>))))</span><br><span class="line"></span><br><span class="line"><span class="comment"># pagination_li_s = driver.find_elements(by=By.XPATH, value=&#x27;//ul[contains(@class,&quot;pagingElements&quot;)]/li&#x27;)</span></span><br><span class="line">last_page = <span class="built_in">int</span>(pagination_li_s[-<span class="number">2</span>].text)</span><br><span class="line"><span class="built_in">print</span>(last_page)</span><br><span class="line"></span><br><span class="line">book_titles = []</span><br><span class="line">book_authors = []</span><br><span class="line">book_lengths = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, last_page + <span class="number">1</span>):</span><br><span class="line">    <span class="comment"># time.sleep(5)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># container = (WebDriverWait(driver,10)</span></span><br><span class="line">    <span class="comment">#              .until(expected_conditions.presence_of_element_located(</span></span><br><span class="line">    <span class="comment">#     (By.XPATH, &#x27;//*[@id=&quot;center-3&quot;]/div/div/div/span[2]/ul&#x27;))))</span></span><br><span class="line">    <span class="comment"># book_list = container.find_elements(by=By.XPATH, value=&#x27;./li&#x27;)</span></span><br><span class="line">    book_list = (WebDriverWait(driver, <span class="number">5</span>)</span><br><span class="line">                 .until(expected_conditions.presence_of_all_elements_located(</span><br><span class="line">        (By.XPATH, <span class="string">&#x27;//*[@id=&quot;center-3&quot;]/div/div/div/span[2]/ul/li&#x27;</span>))))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># book_list = driver.find_elements(by=By.XPATH, value=&#x27;//*[@id=&quot;center-3&quot;]/div/div/div/span[2]/ul/li&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> book_list:</span><br><span class="line">        title = book.find_element(by=By.XPATH, value=<span class="string">&quot;.//h3/a&quot;</span>).text</span><br><span class="line">        <span class="built_in">print</span>(title)</span><br><span class="line">        author = book.find_element(by=By.XPATH, value=<span class="string">&quot;.//li[contains(@class,&#x27;authorLabel&#x27;)]/span&quot;</span>).text</span><br><span class="line">        length = book.find_element(by=By.XPATH, value=<span class="string">&quot;.//li[contains(@class,&#x27;runtimeLabel&#x27;)]/span&quot;</span>).text</span><br><span class="line">        book_titles.append(title)</span><br><span class="line">        book_authors.append(author)</span><br><span class="line">        book_lengths.append(length)</span><br><span class="line"></span><br><span class="line">    next_page = driver.find_element(By.XPATH, <span class="string">&#x27;//*[contains(@class,&quot;nextButton&quot;)]&#x27;</span>)</span><br><span class="line">    next_page.click()</span><br><span class="line"></span><br><span class="line">df = pandas.DataFrame(&#123;</span><br><span class="line">    <span class="string">&quot;book_titles&quot;</span>: book_titles,</span><br><span class="line">    <span class="string">&quot;book_authors&quot;</span>: book_authors,</span><br><span class="line">    <span class="string">&quot;book_lengths&quot;</span>: book_lengths,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">df.to_csv(<span class="string">&#x27;www_audible_com/books.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="twitter-com-login"><a href="#twitter-com-login" class="headerlink" title="twitter.com login"></a>twitter.com login</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">web = <span class="string">&#x27;https://twitter.com/&#x27;</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(web)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">login = driver.find_element(By.XPATH, <span class="string">&#x27;//*[@data-testid=&quot;loginButton&quot;]&#x27;</span>)</span><br><span class="line">login.click()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">username = driver.find_element(By.XPATH, <span class="string">&#x27;//*[@name=&quot;text&quot;]&#x27;</span>)</span><br><span class="line">username.send_keys(<span class="string">&quot;email@qq.com&quot;</span>)</span><br><span class="line"></span><br><span class="line">next_btn = driver.find_element(By.XPATH, <span class="string">&#x27;//*[@role=&quot;dialog&quot;]/div/div/div[2]/div[2]/div/div/div/div[6]&#x27;</span>)</span><br><span class="line">next_btn.click()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"><span class="comment">## 账号异常，需要输入用户名</span></span><br><span class="line">phone_n = driver.find_element(By.XPATH, <span class="string">&#x27;//*[@name=&quot;text&quot;]&#x27;</span>)</span><br><span class="line">phone_n.send_keys(<span class="string">&quot;username&quot;</span>)</span><br><span class="line"></span><br><span class="line">next_btn = driver.find_element(By.XPATH, <span class="string">&#x27;//*[@role=&quot;dialog&quot;]/div/div/div[2]/div[2]/div[2]/div/div/div/div/div&#x27;</span>)</span><br><span class="line">next_btn.click()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">phone_n = driver.find_element(By.XPATH, <span class="string">&#x27;//*[@name=&quot;password&quot;]&#x27;</span>)</span><br><span class="line">phone_n.send_keys(<span class="string">&quot;password123&quot;</span>)</span><br><span class="line"></span><br><span class="line">next_btn = driver.find_element(By.XPATH, <span class="string">&#x27;//*[@role=&quot;dialog&quot;]/div/div/div[2]/div[2]/div[2]/div/div[1]/div/div/div/div&#x27;</span>)</span><br><span class="line">next_btn.click()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<h2 id="快速生成由复制的文本生成-DICT"><a href="#快速生成由复制的文本生成-DICT" class="headerlink" title="快速生成由复制的文本生成 DICT"></a>快速生成由复制的文本生成 DICT</h2><p>regex:    <code>(.*): (.*)</code><br>replace:  <code>&quot;$1&quot;: &quot;$2&quot;,</code></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i: 好人</span><br><span class="line">from: auto</span><br><span class="line">to: </span><br><span class="line">dictResult: true</span><br><span class="line">keyid: webfanyi</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;i&quot;: &quot;好人&quot;,</span><br><span class="line">&quot;from&quot;: &quot;auto&quot;,</span><br><span class="line">&quot;to&quot;: &quot;&quot;,</span><br><span class="line">&quot;dictResult&quot;: &quot;true&quot;,</span><br><span class="line">&quot;keyid&quot;: &quot;webfanyi&quot;,</span><br></pre></td></tr></table></figure>

<h2 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h2><p>from hashlib import md5</p>
<p>def md5_string(string_0):<br>    s &#x3D; md5()<br>    s.update(string_0.encode())</p>
<pre><code>return s.hexdigest()
</code></pre>
</div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/0004%20Formal%20science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF%20Computer%20science/Software%20notations%C2%A0and%C2%A0tools/python/udemy_python_100_days/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">udemy_python_100_days</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/0004%20Formal%20science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF%20Computer%20science/Software%20notations%C2%A0and%C2%A0tools/python/Udemy-Learn-Python-in-60-Days-with-20-Apps/"><span class="level-item">Udemy-The-Python-Mega-Course-Learn-Python-in-60-Days-with-20-Apps</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/0001-Humanities/"><span class="level-start"><span class="level-item">0001 Humanities</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/0001-Humanities/%E5%8E%86%E5%8F%B2%E5%AD%A6-History/"><span class="level-start"><span class="level-item">历史学 History</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/0001-Humanities/%E8%89%BA%E6%9C%AF%E5%AD%A6-Arts/"><span class="level-start"><span class="level-item">艺术学 Arts</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/0002-Social-science/"><span class="level-start"><span class="level-item">0002 Social science</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/0002-Social-science/%E7%BB%8F%E6%B5%8E%E7%AE%A1%E7%90%86%E5%AD%A6-Business-and-Economics/"><span class="level-start"><span class="level-item">经济管理学 Business and Economics</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/0002-Social-science/%E8%AF%AD%E8%A8%80%E5%AD%A6-Linguistics-and-languages/"><span class="level-start"><span class="level-item">语言学 Linguistics and languages</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/0003-Natural-science/"><span class="level-start"><span class="level-item">0003 Natural science</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/0003-Natural-science/%E5%9C%B0%E7%90%83%E7%A7%91%E5%AD%A6-Earth-science/"><span class="level-start"><span class="level-item">地球科学 Earth science</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/0004-Formal-science/"><span class="level-start"><span class="level-item">0004 Formal science</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/0004-Formal-science/%E6%95%B0%E5%AD%A6-Mathematics/"><span class="level-start"><span class="level-item">数学 Mathematics</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/0004-Formal-science/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF-Computer-science/"><span class="level-start"><span class="level-item">计算机科学技术 Computer science</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/0005-Applied-science/"><span class="level-start"><span class="level-item">0005 Applied science</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/0005-Applied-science/%E5%B7%A5%E7%A8%8B%E4%B8%8E%E6%8A%80%E6%9C%AF%E7%A7%91%E5%AD%A6-Engineering-and-technology/"><span class="level-start"><span class="level-item">工程与技术科学 Engineering and technology</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/0005-Applied-science/%E5%B7%A5%E7%A8%8B%E4%B8%8E%E6%8A%80%E6%9C%AF%E7%A7%91%E5%AD%A6-Engineering-and-technology/%E6%9C%BA%E6%A2%B0%E5%B7%A5%E7%A8%8B-Mechanical-engineering/"><span class="level-start"><span class="level-item">机械工程 Mechanical engineering</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/category1-level1/"><span class="level-start"><span class="level-item">category1 level1</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/category1-level1/category1-level2/"><span class="level-start"><span class="level-item">category1 level2</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/jekyll-update/"><span class="level-start"><span class="level-item">jekyll update</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><!--!--></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Lucfe Knowledges</a><p class="is-size-7"><span>&copy; 2024 lucfe</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>